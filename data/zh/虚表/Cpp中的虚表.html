<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'><style type='text/css'>html {overflow-x: initial !important;}</style>
<style type='text/css'  id="style-base">:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, "Segoe UI Emoji", "SF Pro", sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p *, #write.first-line-indent svg * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; position: relative; }
#write svg h1, #write svg h2, #write svg h3, #write svg h4, #write svg h5, #write svg h6, #write svg p { position: static; white-space: nowrap; overflow: visible; }
foreignobject { overflow: visible; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
li p { orphans: 1; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.mermaid-svg { margin: auto; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left: 0.25em solid rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }

</style>
<style type='text/css'  id="style-codemirror">.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}

</style>
<style type='text/css'  id="style-theme_css">/*
 * ------------------------------------------------------------------------
 * mdmdt-dark.css
 * (c) 2024-2025
 * Author: cayxc
 * Homepage:  https://gitee.com/cayxc/mdmdt  https://github.com/cayxc/Mdmdt
 * License: Apache-2.0
 * ------------------------------------------------------------------------
*/
:root {
  --bg-color: #1b1b1f;
  --bg-color2: rgb(40, 42, 50);

  --text-color: #d0d0d0;
  --text-grey: #464b50;
  --text-code: #bbc7fd;
  --title-color: var(--text-color);
  --border-color: var(--text-grey);

  --color-1: #3e69d7;
  --color-1-0-a: rgba(62, 105, 215, 0.3);
  --color-1-0-b: rgba(62, 105, 215, 0.12);

  --color-2: #f59102;
  --color-2-0-a: rgba(245, 145, 2, 0.3);
  --color-2-0-b: rgba(245, 145, 2, 0.12);
  --color-2-0-c: rgba(245, 145, 2, 0.4);

  --color-3: #03b736;
  --color-3-0-a: rgba(3, 183, 54, 0.3);
  --color-3-0-b: rgba(3, 183, 54, 0.12);

  --color-4: #8250df;
  --color-4-0-a: rgba(130, 80, 223, 0.3);
  --color-4-0-b: rgba(130, 80, 223, 0.12);

  --color-5: #e30f2e;
  --color-5-0-a: rgba(227, 15, 46, 0.3);
  --color-5-0-b: rgba(227, 15, 46, 0.12);

  --md-char-color: #667c89ff;
  --meta-content-color: var(--md-char-color);
  --primary-color: var(--color-1);
  --primary-btn-border-color: var(--bg-color2);
  --primary-btn-text-color: var(--text-color);
  --window-border: 1px solid var(--border-color);
  --active-file-bg-color: var(--bg-color2);
  --active-file-text-color: var(--color-1);
  --active-file-border-color: var(--color-1);
  --side-bar-bg-color: var(--bg-color);
  --item-hover-bg-color: var(--bg-color2);
  --item-hover-text-color: var(--color-1);
  --select-text-bg-color: var(--color-1-0-a);
  --monospace: "JetBrains Mono", "Source Code Pro", "Fira Code", Consolas, Inconsolata, "Cascadia Code", Monaco, "Ubuntu Mono", monospace;

  --mermaid-theme: dark; /*or base, dark, forest, neutral, night */
  --mermaid-font-family: "trebuchet ms", verdana, arial, sans-serif;
  --mermaid-sequence-numbers: on;
  --mermaid-flowchart-curve: linear;
  --mermaid--gantt-left-padding: 75;
}

html {
  height: 100vh;
  background-color: var(--bg-color);
  font-size: 16px !important;
  color: var(--text-color);
  -webkit-font-smoothing: antialiased;
  scroll-behavior: smooth;
  scroll-padding: 14px;
}

body {
  margin: 0;
  padding: 0;
  font-size: 16px;
  line-height: 1.6;
  letter-spacing: 0.6px;
  font-family: "PingFang SC", "Microsoft YaHei UI", "Microsoft YaHei", Arial, "Helvetica Neue", Helvetica, sans-serif;
  background: var(--bg-color);
  overflow-x: hidden;
}
body.os-windows {
  font-family: "Microsoft YaHei UI", "Microsoft YaHei", Arial, "Helvetica Neue", Helvetica, sans-serif;
  letter-spacing: 1px;
}
* {
  tab-size: 4;
  -webkit-tab-size: 4;
  -moz-tab-size: 4;
  -o-tab-size: 4;
}

/*
 * ------------------------
 * scroll style
 * ------------------------
*/
::-webkit-scrollbar,
::-webkit-scrollbar {
  width: 8px !important;
  height: 8px !important;
}
::-webkit-scrollbar-thumb,
::-webkit-scrollbar-thumb {
  border-radius: 4px !important;
  background: var(--text-grey) !important;
}
::-webkit-scrollbar-track,
::-webkit-scrollbar-track {
  background: var(--bg-color2) !important;
}
html,
html * {
  scrollbar-color: var(--text-grey) var(--bg-color2) !important;
  scrollbar-width: thin !important;
}

/*
 * -----------------------------------
 * h1 ~ h6, header
 * p, strong, dl, em, u, kbd, hr, mark
 * -----------------------------------
*/
h1, h2, h3, h4, h5, h6 {
  position: relative;
  line-height: 1.5;
  margin: 32px 0 18px;
  color: var(--title-color);
  letter-spacing: 2px;
}
h1 {
  font-size: 32px;
  border-bottom: 1px solid var(--border-color);
}
h2 { font-size: 28px; }
h3 { font-size: 24px; }
h4 { font-size: 20px; }
h5 { font-size: 18px; }
h6 { font-size: 16px; }

#write > h1 + *,
#write > h2 + *,
#write > h3 + *,
#write > h4 + *,
#write > h5 + *,
#write > h6 + * {
  margin-top: 18px !important;
}

#write > h1::before,
#write > h2::before,
#write > h3::before,
#write > h4::before,
#write > h5::before,
#write > h6::before,
#write > h1.md-focus::before,
#write > h2.md-focus::before,
#write > h3.md-focus::before,
#write > h4.md-focus::before,
#write > h5.md-focus::before,
#write > h6.md-focus::before {
  display: none;
  position: absolute;
  left: -36px;
  height: 20px;
  padding-left: 6px;
  padding-right: 3px;
  border: 1px solid var(--color-1);
  border-radius: 4px;
  font-size: 12px;
  font-weight: 700;
  color: var(--color-1);
}
#write > h1::before,
#write > h1.md-focus::before {
  content: 'h1';
  top: 15px;
}
#write > h2::before,
#write > h2.md-focus::before {
  content: 'h2';
  top: 10.5px;
}
#write > h3::before,
#write > h3.md-focus::before {
  content: 'h3';
  top: 8px;
}
#write > h4::before,
#write > h4.md-focus::before {
  content: 'h4';
  top: 5.5px;
}
#write > h5::before,
#write > h5.md-focus::before {
  content: 'h5';
  top: 4px;
}
#write > h6::before,
#write > h6.md-focus::before {
  content: 'h6';
  top: 2.5px;
}
#write > h1:hover::before,
#write > h2:hover::before,
#write > h3:hover::before,
#write > h4:hover::before,
#write > h5:hover::before,
#write > h6:hover::before {
  display: block;
}

hr {
  height: 1px;
  box-sizing: border-box;
  background: var(--border-color);
  border: none;
}

p {
  margin-top: 16px;
  margin-bottom: -5px;
  white-space: pre-wrap;
}
#write > p + p {
  margin-top: 24px;
}
p:has(span.md-image) {
  margin-bottom: 0;
}

strong {
  font-weight: 800;
  color: #cfdfff;
}

u {
  text-underline-offset: 4px;
  text-decoration-thickness: 1.5px;
}

em {
  font-weight: 400;
}

del {
  color: var(--text-grey);
  text-decoration: line-through;
  text-decoration-color: var(--color-5);
  -moz-text-decoration-color: var(--color-5);
}

mark {
  border-radius: 5px;
  background-color: var(--color-1);
  padding: 0 4px;
  color: rgb(250, 250, 250);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

/*
 * ------------------------
 * a, link
 * ------------------------
*/
a {
  position: relative;
  font-weight: 500;
  text-decoration: none;
  color: var(--color-1);
  font-size: 16px;
  text-underline-offset: 4px;
}
a:hover,
.md-link a:hover,
.footnotes a:hover {
  color: var(--color-2);
  text-decoration: underline;
  cursor: pointer !important;
}
/*以下写法是防止导出pdf时再标题或代码块部分生成链接图标*/
#write p a,
#write table a,
#write blockquote a,
#write .md-alert a,
#write li a {
  padding-left: 2px;
}
#write p a::before,
#write table a::before,
#write blockquote a::before,
#write .md-alert a::before,
#write li a::before {
  content: "";
  display: inline-block;
  position: relative;
  top: 2px;
  right: 2px;
  z-index: 30;
  width: 14px;
  height: 14px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 100%;
  background-image: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNzQxNDk2OTA4OTA2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE1NjgiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTIyNy44NCAyMS41MDRjLTQxLjQ3MiA3LjY4LTk3LjI4IDM3Ljg4OC0xMzAuMDQ4IDcwLjY1NkM0Ny42MTYgMTQyLjg0OCAyMC40OCAyMDcuMzYgMjAuNDggMjc2Ljk5MmMwIDc1Ljc3NiAxOC45NDQgMTIzLjM5MiA3Ni4yODggMTkzLjAyNCAzMC4yMDggMzUuODQgMTA1Ljk4NCAxMDguNTQ0IDExNy4yNDggMTEyLjY0IDIuNTYgMC41MTIgNi42NTYtMTQuMzM2IDguNzA0LTMzLjI4IDIuMDQ4LTE4Ljk0NCA3LjY4LTQ4LjEyOCAxMy4zMTItNjQgMTUuODcyLTQ4LjEyOCAxNC4zMzYtNTMuNzYtMjYuNjI0LTkzLjY5NkMxNjQuODY0IDM0Ny42NDggMTQ4LjQ4IDMxNS4zOTIgMTQ4LjQ4IDI3My40MDhjMC05OC44MTYgMTAzLjQyNC0xNjEuMjggMTg1Ljg1Ni0xMTMuMTUyIDExLjc3NiA3LjE2OCA3MS4xNjggNjMuNDg4IDEzMi42MDggMTI0LjkyOCAxMjAuODMyIDEyMS44NTYgMTIwLjMyIDEyMS4zNDQgMTE1LjcxMiAxNzcuMTUyLTEuNTM2IDE5LjQ1Ni03LjY4IDM0LjgxNi0yMC45OTIgNTUuODA4LTIyLjAxNiAzNC4zMDQtMjUuMDg4IDYyLjk3Ni04LjcwNCA4OS42IDEyLjI4OCAyMC40OCAyNS42IDI3LjY0OCA1My4yNDggMjguNjcyIDMyLjc2OCAxLjUzNiA1NC4yNzItMTUuODcyIDc4Ljg0OC02Mi45NzYgMjQuNTc2LTQ2LjU5MiAzMi4yNTYtNzYuOCAzMi4yNTYtMTI2LjQ2NCAwLTUzLjc2LTE1Ljg3Mi0xMDAuODY0LTUyLjIyNC0xNTUuMTM2LTIwLjk5Mi0zMC43Mi0xNjIuODE2LTE3My41NjgtMjEwLjk0NC0yMTEuOTY4QzM4NS41MzYgMjUuMDg4IDMxMC4yNzIgNS42MzIgMjI3Ljg0IDIxLjUwNHoiIGZpbGw9IiMzZTY5ZDciIHAtaWQ9IjE1NjkiPjwvcGF0aD48cGF0aCBkPSJNMzkxLjY4IDM5MS42OGMtMjQuMDY0IDExLjI2NC0zMS4yMzIgMTguNDMyLTUxLjIgNTUuMjk2LTI0LjA2NCA0NC4wMzItMzMuMjggNzguMzM2LTMzLjc5MiAxMjggMCA1NS4yOTYgMTUuMzYgMTAxLjg4OCA1Mi4yMjQgMTU3LjE4NCAyMS41MDQgMzIuMjU2IDE3Ny4xNTIgMTg2Ljg4IDIxOS42NDggMjE5LjEzNiAzOS40MjQgMjkuMTg0IDc4LjMzNiA0Ni4wOCAxMjQuNDE2IDUzLjI0OCAxNTcuMTg0IDI0LjA2NCAzMDAuNTQ0LTk4LjgxNiAzMDAuNTQ0LTI1Ny41MzYgMC03NS43NzYtMTguOTQ0LTEyMy4zOTItNzYuMjg4LTE5My4wMjQtMzAuMjA4LTM1Ljg0LTEwNS45ODQtMTA4LjU0NC0xMTcuMjQ4LTExMi42NC0yLjU2LTAuNTEyLTYuNjU2IDE0LjMzNi04LjcwNCAzMy4yOC0yLjA0OCAxOC45NDQtNy42OCA0OC4xMjgtMTMuMzEyIDY0LTE1Ljg3MiA0OC4xMjgtMTQuMzM2IDUzLjc2IDI2LjYyNCA5My42OTYgNDQuNTQ0IDQ0LjAzMiA2MC45MjggNzYuMjg4IDYwLjkyOCAxMTguMjcyIDAgOTguODE2LTEwMy40MjQgMTYxLjI4LTE4NS44NTYgMTEzLjE1Mi0xMS43NzYtNy4xNjgtNzEuMTY4LTYzLjQ4OC0xMzIuNjA4LTEyNC45MjgtMTIwLjgzMi0xMjEuODU2LTEyMC4zMi0xMjEuMzQ0LTExNS43MTItMTc3LjE1MiAxLjUzNi0xOS40NTYgNy42OC0zNC44MTYgMjAuOTkyLTU1LjgwOCAxNC4zMzYtMjIuMDE2IDE4Ljk0NC0zNC4zMDQgMTguOTQ0LTUxLjIgMC0yMy41NTItMTMuODI0LTUxLjItMjkuMTg0LTU5LjM5Mi0xNy45Mi05LjIxNi00NS4wNTYtMTAuNzUyLTYwLjQxNi0zLjU4NHoiIGZpbGw9IiMzZTY5ZDciIHAtaWQ9IjE1NzAiPjwvcGF0aD48L3N2Zz4=");
}
#write a:hover::before {
  background-image: url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNzQxNDk3MDE4MTgyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjExMDciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTIyNy44NCAyMS41MDRjLTQxLjQ3MiA3LjY4LTk3LjI4IDM3Ljg4OC0xMzAuMDQ4IDcwLjY1NkM0Ny42MTYgMTQyLjg0OCAyMC40OCAyMDcuMzYgMjAuNDggMjc2Ljk5MmMwIDc1Ljc3NiAxOC45NDQgMTIzLjM5MiA3Ni4yODggMTkzLjAyNCAzMC4yMDggMzUuODQgMTA1Ljk4NCAxMDguNTQ0IDExNy4yNDggMTEyLjY0IDIuNTYgMC41MTIgNi42NTYtMTQuMzM2IDguNzA0LTMzLjI4IDIuMDQ4LTE4Ljk0NCA3LjY4LTQ4LjEyOCAxMy4zMTItNjQgMTUuODcyLTQ4LjEyOCAxNC4zMzYtNTMuNzYtMjYuNjI0LTkzLjY5NkMxNjQuODY0IDM0Ny42NDggMTQ4LjQ4IDMxNS4zOTIgMTQ4LjQ4IDI3My40MDhjMC05OC44MTYgMTAzLjQyNC0xNjEuMjggMTg1Ljg1Ni0xMTMuMTUyIDExLjc3NiA3LjE2OCA3MS4xNjggNjMuNDg4IDEzMi42MDggMTI0LjkyOCAxMjAuODMyIDEyMS44NTYgMTIwLjMyIDEyMS4zNDQgMTE1LjcxMiAxNzcuMTUyLTEuNTM2IDE5LjQ1Ni03LjY4IDM0LjgxNi0yMC45OTIgNTUuODA4LTIyLjAxNiAzNC4zMDQtMjUuMDg4IDYyLjk3Ni04LjcwNCA4OS42IDEyLjI4OCAyMC40OCAyNS42IDI3LjY0OCA1My4yNDggMjguNjcyIDMyLjc2OCAxLjUzNiA1NC4yNzItMTUuODcyIDc4Ljg0OC02Mi45NzYgMjQuNTc2LTQ2LjU5MiAzMi4yNTYtNzYuOCAzMi4yNTYtMTI2LjQ2NCAwLTUzLjc2LTE1Ljg3Mi0xMDAuODY0LTUyLjIyNC0xNTUuMTM2LTIwLjk5Mi0zMC43Mi0xNjIuODE2LTE3My41NjgtMjEwLjk0NC0yMTEuOTY4QzM4NS41MzYgMjUuMDg4IDMxMC4yNzIgNS42MzIgMjI3Ljg0IDIxLjUwNHoiIGZpbGw9IiNmNTkxMDIiIHAtaWQ9IjExMDgiPjwvcGF0aD48cGF0aCBkPSJNMzkxLjY4IDM5MS42OGMtMjQuMDY0IDExLjI2NC0zMS4yMzIgMTguNDMyLTUxLjIgNTUuMjk2LTI0LjA2NCA0NC4wMzItMzMuMjggNzguMzM2LTMzLjc5MiAxMjggMCA1NS4yOTYgMTUuMzYgMTAxLjg4OCA1Mi4yMjQgMTU3LjE4NCAyMS41MDQgMzIuMjU2IDE3Ny4xNTIgMTg2Ljg4IDIxOS42NDggMjE5LjEzNiAzOS40MjQgMjkuMTg0IDc4LjMzNiA0Ni4wOCAxMjQuNDE2IDUzLjI0OCAxNTcuMTg0IDI0LjA2NCAzMDAuNTQ0LTk4LjgxNiAzMDAuNTQ0LTI1Ny41MzYgMC03NS43NzYtMTguOTQ0LTEyMy4zOTItNzYuMjg4LTE5My4wMjQtMzAuMjA4LTM1Ljg0LTEwNS45ODQtMTA4LjU0NC0xMTcuMjQ4LTExMi42NC0yLjU2LTAuNTEyLTYuNjU2IDE0LjMzNi04LjcwNCAzMy4yOC0yLjA0OCAxOC45NDQtNy42OCA0OC4xMjgtMTMuMzEyIDY0LTE1Ljg3MiA0OC4xMjgtMTQuMzM2IDUzLjc2IDI2LjYyNCA5My42OTYgNDQuNTQ0IDQ0LjAzMiA2MC45MjggNzYuMjg4IDYwLjkyOCAxMTguMjcyIDAgOTguODE2LTEwMy40MjQgMTYxLjI4LTE4NS44NTYgMTEzLjE1Mi0xMS43NzYtNy4xNjgtNzEuMTY4LTYzLjQ4OC0xMzIuNjA4LTEyNC45MjgtMTIwLjgzMi0xMjEuODU2LTEyMC4zMi0xMjEuMzQ0LTExNS43MTItMTc3LjE1MiAxLjUzNi0xOS40NTYgNy42OC0zNC44MTYgMjAuOTkyLTU1LjgwOCAxNC4zMzYtMjIuMDE2IDE4Ljk0NC0zNC4zMDQgMTguOTQ0LTUxLjIgMC0yMy41NTItMTMuODI0LTUxLjItMjkuMTg0LTU5LjM5Mi0xNy45Mi05LjIxNi00NS4wNTYtMTAuNzUyLTYwLjQxNi0zLjU4NHoiIGZpbGw9IiNmNTkxMDIiIHAtaWQ9IjExMDkiPjwvcGF0aD48L3N2Zz4=");
}
sup a,
a.reversefootnote {
  padding-left: 0 !important;
}
sup a::before,
a.reversefootnote::before,
.md-toc-content .md-toc-item > a::before {
  display: none;
  width: 0 !important;
  height: 0 !important;
  background-image: none !important;
}
a:hover {
  color: var(--color-2);
}
.footnotes,
.footnotes a {
  font-size: 14px;
  text-decoration: none;
}
.footnotes .md-def-name::before,
.footnotes .md-def-name::after {
  color: var(--text-color);
}
.footnotes .md-def-url,
.md-link .md-url {
  text-decoration: none;
  color: var(--color-1);
}

/*
 * ------------------------
 * ul, ol
 * ------------------------
*/
ul, ol {
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 0;
}
#write > p + ul,
#write > p + ol,
blockquote > ul,
blockquote > ol,
.md-alert > ul,
.md-alert > ol{
  margin-top: 11px;
}
ul {
  padding-left: 36px;
}
ol {
  padding-left: 40px;
}
ol ol {
  margin-left: -7px;
}
ol > li > ul {
  margin-left: -7px;
}
ul > li > ol {
  margin-left: -2px;
}
ul > li > p {
  margin: 0 0 0 -2px;
}
ol > li > p {
  margin: 0 0 0 -6px;
}
ul > .task-list-item > input {
  margin-left: -22px;
}
#write li {
  margin-top: 6px;
}
li > p {
  margin: -5px 0;
}

#write li img,
#write li pre,
#write li figure,
#write li blockquote,
#write li .md-alert {
  margin-top: 11px !important;
  margin-bottom: 11px !important;
}
#write li pre pre,
#write li .md-image {
  margin-top: 0 !important;
  margin-bottom: 0 !important;
}

/*
 * ------------------------
 * image
 * ------------------------
*/
img,
span.md-image {
  margin: 16px auto 0 auto !important;
  border-radius: 8px !important;
  border: none !important;
  color: var(--md-char-color);
}
p.md-focus span.md-image {
  background: var(--color-1-0-b);
  box-shadow: 0 0 3px var(--border-color);
}
p.md-focus span.md-image {
  margin-top: 0;
}
span.md-image,
span.md-image span.md-content,
span.md-image span.md-image-src-span,
span.md-image span.md-image-before-src,
span.md-image span.md-image-after-src,
span.md-image span.md-image-input-src-btn,
span.md-image span.md-image-pick-file-btn,
span.md-image span.md-before::before,
span.md-image span.md-image-input-src-btn::before,
span.md-image span.md-image-pick-file-btn::before {
  color: var(--color-1);
}
span.md-image-btn {
  background: var(--bg-color2);
}
span.md-image-btn:hover::before {
  color: var(--bg-color) !important;
}
span.md-image span.md-image-pick-file-btn {
  border-left-color: var(--border-color);
}
.typora-export #write section:has(img),
.md-htmlblock-container section:has(img) {
  display: grid;
  grid-gap: 16px;
  justify-content: flex-start;
  align-items: center;
  grid-template-columns: repeat(auto-fit, minmax(16px, auto));
  grid-auto-rows: minmax(16px, auto);
}
.typora-export #write > section:has(img) {
  margin-top: 16px;
}
.typora-export #write section img,
.md-htmlblock-container section img {
  margin: 0 !important;
}
.typora-export #write section:has(img) span,
.md-htmlblock-container section:has(img) span {
  display: block;
  margin: 8px 0;
}
.typora-export #write section span > img,
.md-htmlblock-container section span > img {
  margin: 8px 0 !important;
}
.typora-export #write section span > img:first-of-type,
.md-htmlblock-container section span > img:first-of-type {
  margin-top: 0 !important;
}
.typora-export #write section span > img:last-of-type,
.md-htmlblock-container section span > img:last-of-type {
  margin-bottom: 0 !important;
}
.typora-export #write > section:has(img):hover,
.md-htmlblock-container > section:has(img):hover{
  border-radius: 8px;
  background: var(--bg-color2);
  padding: 16px;
  transition: padding .3s linear;
  -webkit-transition: padding .3s linear;
}

/*
 * ------------------------
 * code
 * ------------------------
*/
code {
  border-radius: 4px;
  background: var(--color-1-0-a);
  padding: 3px 5px;
  color: var(--text-code);
  font-size: 14px;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}
h1 code {
  font-size: 26px;
}
h2 code {
  font-size: 22px;
}
h3 code {
  font-size: 18px;
}
h4 code {
  font-size: 16px;
}
.outline-content .outline-item code {
  font-size: 11px;
  padding: 2px 4px;
  border-radius: 3px;
  vertical-align: middle;
}

/*
 * ------------------------
 * pre
 * ------------------------
*/
pre {
  margin-top: 16px;
  margin-bottom: 0;
  box-sizing: border-box;
  background: var(--bg-color2) !important;
  border-radius: 8px;
  font-size: 14px !important;
  color: var(--text-code);
}
pre pre {
  background: transparent !important;
  padding: 5px 10px;
  border: none;
}
pre .CodeMirror-wrap {
  padding: 16px 16px 16px 0;
}
pre .CodeMirror-wrap .CodeMirror-scroll {
  overflow-x: auto;
}
pre .CodeMirror-sizer {
  padding-left: 4px;
}
pre .CodeMirror-gutters {
  background: var(--bg-color2);
  border-color: var(--border-color);
}

/*
 * ------------------------
 * blockquote
 * ------------------------
*/
blockquote,
.md-alert {
  margin-top: 16px !important;
  margin-bottom: 0;
  padding: 16px;
  background: var(--color-1-0-b);
  box-sizing: border-box;
  border-radius: 8px;
  border-left: 4px solid var(--color-1);
  border-right: 0.1px solid transparent;
  border-bottom: 0.1px solid transparent;
  border-top: 0.1px solid transparent;
}
blockquote > *:first-child,
.md-alert > *:first-child {
  margin-top: 0 !important;
}
blockquote > *:last-child,
.md-alert > *:last-child {
  margin-bottom: 0 !important;
}
.md-alert.md-alert-note {
  border-left-color: var(--color-1);
  background: var(--color-1-0-b);
  color: var(--color-1);
}
.md-alert.md-alert-note .md-alert-text-note {
  color: var(--color-1);
}
.md-alert.md-alert-caution {
  border-left-color: var(--color-2);
  background: var(--color-2-0-b);
  color: var(--color-2);
}
.md-alert.md-alert-caution .md-alert-text-caution {
  color: var(--color-2);
}
.md-alert.md-alert-tip {
  border-left-color: var(--color-3);
  background: var(--color-3-0-b);
  color: var(--color-3);
}
.md-alert.md-alert-tip .md-alert-text-tip {
  color: var(--color-3);
}
.md-alert.md-alert-important {
  border-left-color: var(--color-4);
  background: var(--color-4-0-b);
  color: var(--color-4);
}
.md-alert.md-alert-important .md-alert-text-important {
  color: var(--color-4);
}
.md-alert.md-alert-warning {
  border-left-color: var(--color-5);
  background: var(--color-5-0-b);
  color: var(--color-5);
}
.md-alert.md-alert-warning .md-alert-text-warning {
  color: var(--color-5);
}

/*
 * ------------------------
 * sup, sub, kbd
 * ------------------------
*/
sup, sub {
  font-size: 12px;
}
sup.md-footnote {
  background: transparent;
  padding: 0 2px;
  color: var(--color-1);
}
sup.md-footnote:hover {
  color: var(--color-2);
  cursor: pointer;
}
kbd {
  display: inline-block;
  border: none;
  border-image: none;
  border-radius: 5px;
  background: var(--color-2);
  padding: 0 6px;
  box-shadow: none;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
  font-size: 14px;
  font-weight: 900;
  color: rgb(250, 250, 250);
}
::selection {
  background: var(--color-2-0-c);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

/*
 * ------------------------
 * table
 * ------------------------
*/
table,
figure {
  width: 100%;
  margin-bottom: 0;
  border-radius: 8px;
  padding: 0 !important;
  border-collapse: separate;
  border-spacing: 0;
}
figure {
  margin-top: 16px !important;
}
table {
  margin-top: 0;
  border: 1px solid var(--border-color) !important;
  overflow: hidden;
}
table thead tr th {
  background: var(--bg-color2);
}
table tbody tr:nth-child(even) td {
  background: var(--bg-color2);
}
table tbody tr:nth-child(odd) td {
  background: var(--bg-color);
}
table tr th, table tr td {
  padding: 10px !important;
  white-space: pre-wrap !important;
}
table tr td,
table thead tr th {
  border-left: 1px solid var(--border-color) !important;
}
table tbody tr td:first-of-type,
table thead tr th:first-of-type {
  border-left: none !important;
}
.md-grid-board-wrap table {
  border: none !important;
  border-radius: 0;
}
.md-grid-board-wrap table tr th,
.md-grid-board-wrap table tr td {
  padding: 0 !important;
}
#md-grid-width,
#md-grid-height {
  text-align: center !important;
  padding: 1px 0;
}
button#md-resize-grid {
  display: block !important;
  width: 100%;
  margin: 5px auto 0;
  color: var(--bg-color);
}
button#md-resize-grid:hover {
  color: var(--color-1);
  border-color: var(--color-1);
}
.ty-table-edit {
  margin-left: 0;
}
.md-tooltip-remove {
  position: absolute;
  z-index: 200;
  margin-top: -28px !important;
  background: var(--bg-color);
}
.md-tooltip-remove .md-delete-table {
  margin-right: 10px !important;
}
.md-table-resize-popover .md-reset > a::before {
  display: none !important;
}

/*
 * ------------------------
 * btn
 * ------------------------
*/
.btn,
.btn-default,
.long-btn {
  border-radius: 5px !important;
  border: 1px solid var(--border-color) !important;
  background: var(--bg-color2) !important;
  outline: none !important;
}
.btn-primary {
  background: var(--color-1) !important;
  border-color: var(--color-1) !important;
  color: #fff;
}

.btn:hover,
.long-btn:hover {
  background: var(--color-1-0-b) !important;
  border-color: var(--color-1) !important;
  color: var(--color-1);
}

.btn:focus,
.long-btn:focus {
  outline: none !important;
}
.btn {
  margin-right: 5px !important;
}
.btn:last-of-type {
  margin-right: 0;
}
.dropdown-toggle::after {
  font-size: 14px;
}
.dropdown-toggle:hover::after {
  color: var(--color-1);
}

/*
 * ------------------------
 * select
 * ------------------------
 */
select {
  border-radius: 6px !important;
  border: 1px solid var(--border-color) !important;
  padding: 6px !important;
}
option {
  background: var(--bg-color);
}
/*
 * ------------------------
 * textarea
 * ------------------------
 */
textarea {
  outline: none;
  padding: 16px;
  border-radius: 8px;
  border-color: var(--border-color);
  background: var(--bg-color) !important;
  color: var(--text-color) !important;
}
#write textarea {
  margin-top: 14px !important;
  margin-bottom: 0;
}

/*
 * ------------------------
 * input
 * ------------------------
*/
html input,
input {
  position: relative;
  border-radius: 5px !important;
  border: 1px solid var(--border-color);
  outline: none !important;
  padding: 0 6px;
  line-height: 1.2;
}
html input:focus,
html textarea:focus,
html input[type="number"]:focus,
html input[type="search"]:focus,
html input[type="text"]:focus {
  border-color: var(--color-1) !important;
  box-shadow: none !important;
  outline: none !important;
}
input::placeholder {
  font-size: 14px;
  color: var(--text-grey) !important;
}

/*input checkbox*/
input[type="checkbox"],
input[type="radio"] {
  margin-right: 10px !important;
  margin-bottom: -2px !important;
  width: 14px !important;
  height: 14px !important;
  box-sizing: border-box;
  background: transparent !important;
  border: 1px solid var(--border-color) !important;
  border-radius: 3px !important;
  padding: 0 !important;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  -ms-appearance: none;
  list-style: none;
}
input[type="checkbox"]:checked,
input[type="radio"]:checked {
  background: var(--color-1) !important;
  border-color: transparent !important;
}
input[type="checkbox"]:checked::after {
  content: "";
  display: block;
  position: absolute;
  bottom: 2.5px;
  left: 3.5px;
  width: 5px;
  height: 9px;
  box-sizing: border-box;
  background: transparent;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  transform: rotate(40deg);
  -webkit-transform: rotate(40deg);
  -ms-transform: rotate(40deg);
}
input[type="radio"] {
  border-radius: 50% !important;
  -webkit-border-radius: 50% !important;
  -moz-border-radius: 50% !important;
  border: 1px solid var(--border-color) !important;
}
input[type="radio"]:checked::after {
  content: "";
  display: block;
  margin: 3.5px auto;
  width: 5px;
  height: 5px;
  box-sizing: border-box;
  background: #fff;
  border-radius: 50%;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
}

/*
 * ------------------------
 * header
 * ------------------------
*/
body > header {
  background: var(--bg-color) !important;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.15), 0 2px 5px 0 rgba(0, 0, 0, 0.1);
}

/*
 * ------------------------
 * md-htmlblock
 * md-mathblock
 * ------------------------
*/
.md-htmlblock-panel,
.md-htmlblock-container,
.md-htmlblock-container .md-htmlblock-panel-placeholder {
  background: transparent;
}
.md-htmlblock-container,
.md-math-container {
  border-radius: 8px;
  background: var(--bg-color);
  overflow: auto;
}
.md-math-container {
  width: 100%;
  padding: 16px;
}

.md-rawblock-on-edit .md-htmlblock-panel,
.md-rawblock-on-edit .md-mathblock-panel {
  border-radius: 8px;
  background: var(--bg-color2);
  padding: 16px;
}
.md-mathblock-panel .md-rawblock-control {
  background: transparent;
}
.md-mathblock-panel .code-tooltip {
  margin: 14px 6px 0;
  box-shadow: none;
  border-top: 1px solid var(--border-color);
  border-radius: 0;
}
.code-tooltip {
  box-shadow: none;
}
.code-tooltip .ty-input {
  border-color: var(--border-color);
}
.md-rawblock-on-edit .md-rawblock-input {
  padding: 0;
  background: transparent;
}
.md-rawblock .md-rawblock-tooltip {
  float: right;
  margin-top: -11px;
  height: auto;
  border-radius: 5px;
  background: var(--bg-color2);
  animation: none !important;
}
.md-rawblock .md-rawblock-tooltip span {
  padding-top: 4px;
  padding-bottom: 4px;
}
.md-rawblock .md-rawblock-tooltip-edit-btn:hover {
  background: transparent;
}

.md-htmlblock:hover .md-htmlblock-container,
.md-htmlblock:hover .md-rawblock-tooltip,
.md-math-block:hover .md-math-container,
.md-math-block:hover .md-rawblock-tooltip,
.md-rawblock-on-edit:hover .md-rawblock-tooltip {
  background: var(--bg-color2);
}
.md-inline-math script {
  color: #f9007c;
}

/*
 * ------------------------
 * #write
 * ------------------------
*/
#write {
  margin: 0 auto;
  width: 100%;
  max-width: 1424px;
  min-width: 300px;
  padding: 32px 112px;
  overflow: auto;
  /*  scroll-behavior: smooth;
    scroll-padding: 16px;*/
}
#write > *:first-child {
  margin-top: 0;
}

span.md-comment {
  color: var(--md-char-color);
  opacity: 1;
}
.md-image-btn.selected, .md-image-btn:hover {
  background: var(--color-1);
}
#write pre.md-meta-block:empty:before {
  color: var(--text-code);
}

/*
 * ------------------------
 * typora-source
 * ------------------------
*/
#typora-source .CodeMirror-sizer {
  padding-right: 0 !important;
}
#typora-source .CodeMirror-lines {
  margin: 0 auto;
  max-width: 1424px;
  min-width: 300px;
  padding: 32px 112px;
}
#typora-source .CodeMirror-lines pre {
  border: none !important;
  background: var(--bg-color) !important;
  padding: 8px 16px !important;
  font-size: 16px !important;
}
#typora-source .CodeMirror-activeline pre {
  background: var(--bg-color2) !important;
  border-radius: 6px;
}
#typora-source .CodeMirror-activeline .CodeMirror-linebackground {
  background: transparent !important;
}
#typora-source .CodeMirror-lines .cm-header {
  color: var(--color-2);
}
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor {
  border-left: 3px solid var(--color-2);
}
.CodeMirror div.CodeMirror-cursor {
  border-color: var(--text-color);
}
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property,
.cm-s-typora-default .cm-link {
  color: var(--color-2);
}
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment, .cm-overlay {
  color: var(--md-char-color);
}
.cm-s-typora-default .cm-string {
  color: var(--color-1);
}
.cm-s-typora-default .cm-code, .cm-s-typora-default .cm-comment {
  color: var(--text-code);
}
.cm-s-typora-default .cm-tag {
  color: #e31570;
}

.cm-attribute {
  color: var(--color-2);
}

/*
 * ------------------------
 * #toc-dropmenu
 * ------------------------
*/
#toc-dropmenu {
  top: calc(var(--title-bar-height) + 8px) !important;
  right: 18px;
  border-top-left-radius: 8px;
  border-bottom-left-radius: 8px;
}
#toc-dropmenu #pin-outline-btn {
  display: inline-block;
  top: 10px;
}
#toc-dropmenu .divider {
  margin-bottom: 0;
}

/*
 * ------------------------
 * sidebar
 * toc-content
 * ------------------------
*/
.os-windows #sidebar-content {
  margin-top: -1px;
  border-top: 1px solid var(--border-color);
}
.os-windows .ty-show-outline-filter #sidebar-content .sidebar-content-content {
  margin-top: -4px;
}
.os-windows .ty-show-search #sidebar-content .sidebar-content-content {
  margin-top: -7px;
}
.sidebar-tabs {
  padding: 0 2px;
}
.outline-content {
  overflow: auto !important;
  padding: 14px 14px 14px 17px;
  font-size: 14px !important;
}
.os-windows .outline-content {
  padding-top: 15px;
}
.outline-content li {
  position: relative;
  z-index: 30;
}
.outline-content > li:first-of-type::before {
  top: 0;
}
.outline-content li ul {
  position: relative;
  z-index: 48;
  margin-left: 18px;
  margin-top: 0 !important;
}
.no-collapse-outline .outline-content li ul {
  margin-left: 21px;
}
.outline-content li .outline-item {
  position: relative;
  z-index: 50;
  margin: 0 0 3px 7px;
  width: calc(100% - 4px);
  border-radius: 5px;
  border: none;
  line-height: 1;
  padding: 0 0 0 4px;
}
.outline-item > .outline-expander {
  display: block;
  float: left;
  width: auto;
  height: 0;
  background: transparent;
  padding-left: 0;
}
.outline-item > .outline-expander:before {
  margin-top: 10px;
  margin-left: -2px;
  background: transparent;
  padding: 0 4px 0 2px;
  font-size: 10px;
}
.outline-content li .outline-label {
  display: inline-block;
  border-radius: 4px;
  padding: 7px 7px 7px 8px;
  font-size: 14px !important;
  line-height: 1.2;
  overflow-wrap: normal;
  word-wrap: normal;
  word-break: keep-all;
  white-space: nowrap;
  text-decoration: none;
}
.outline-item-single .outline-label,
.outline-item-single.outline-item-open .outline-label,
.no-collapse-outline .outline-content li .outline-label {
  padding-left: 0 !important;
}
.outline-item > .outline-expander:hover + .outline-label,
.outline-item-open > .outline-item > .outline-label {
  padding-left: 11px;
}
.no-collapse-outline .outline-item-open > .outline-item > .outline-label {
  padding-left: 0 !important;
}
.outline-item-active > .outline-expander:hover + .outline-label,
.outline-item-open > .outline-item-active > .outline-label {
  padding-left: 12px;
}
.outline-item-active > .outline-expander,
.outline-item-active > .outline-label {
  font-weight: 900;
}
.outline-content li .outline-item::before {
  content: '';
  position: absolute;
  z-index: 38;
  left: -10px;
  top: -27.5px;
  width: 10px;
  height: calc(50% + 28px);
  background: transparent;
  border-left: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
}
.os-windows .outline-content li .outline-item::before {
  top: -28.5px;
}
.outline-content > li:first-of-type > .outline-item::before {
  top: calc(50% - 1px);
  height: calc(50% + 15px);
  border-left: 1px solid var(--border-color);
  border-top: 1px solid var(--border-color);
  border-bottom: none;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 0;
}
.outline-children > li:first-child > .outline-item::before,
.outline-content > li:nth-child(2) > .outline-item::before {
  top: -11px;
  height: calc(50% + 12px);
}
.os-windows .outline-children > li:first-child > .outline-item::before,
.os-windows .outline-content > li:nth-child(2) > .outline-item::before {
  top: -13px;
  height: calc(50% + 13px);
}
.no-collapse-outline .outline-children > li:first-child > .outline-item::before,
.no-collapse-outline .outline-content > li:nth-child(2) > .outline-item::before {
  top: -8px;
  height: calc(50% + 8px);
}
.outline-content > li:last-child > .outline-item::before,
.outline-children > li:last-child > .outline-item::before {
  border-bottom-left-radius: 3px;
}
.no-collapse-outline .outline-item-wrapper > .outline-children::before,
.outline-item-open > .outline-children::before {
  content: '';
  position: absolute;
  left: -21px;
  top: -26px;
  width: 1px;
  height: calc(100% + 12px);
  background: transparent;
  border-left: 1px solid var(--border-color);
}
.no-collapse-outline .outline-item-wrapper > .outline-children::before {
  left: -24px;
}
.no-collapse-outline .outline-content > li.outline-item-wrapper:first-child > .outline-children::before,
.outline-content > li.outline-item-open:first-child > .outline-children::before {
  top: -15px;
}
.outline-content > li:only-of-type > .outline-item::before,
.no-collapse-outline .outline-item-wrapper:last-of-type > .outline-children::before,
.no-collapse-outline .outline-children > li.outline-item-wrapper:last-child > .outline-children::before,
.outline-item-open:last-of-type > .outline-children::before,
.outline-children > li.outline-item-open:last-child > .outline-children::before {
  display: none;
}
.outline-content > li:only-of-type {
  margin-left: -8px;
}
li > .outline-item-active:before,
.outline-item:hover::before,
.outline-item-active > .outline-item::before {
  width: 7px !important;
}
li > .outline-item-active,
li > .outline-item:hover,
.outline-item-active > .outline-item {
  margin-left: 4px !important;
  padding-left: 7px !important;
}

li > .outline-item-active::before,
li > .outline-item:hover::before,
.outline-item-active > .outline-item::before {
  left: -7px !important;
}
.outline-item:hover,
.outline-item:hover > .outline-label,
.outline-item-active,
.outline-item-active > .outline-label {
  background: var(--bg-color2) !important;
}
.outline-item-active > .outline-label,
.outline-item-active > .outline-expander::before {
  color: var(--color-1);
}
.ty-on-outline-filter .outline-content .outline-item::before,
.ty-on-outline-filter .outline-content .outline-item::after {
  display: none;
}
.ty-on-outline-filter .outline-content > li > ul,
.ty-on-outline-filter .outline-content .outline-item {
  margin-left: 0;
}

/* .oultine-item search result */
.outline-content:has(.ty-outline-hit) {
  padding-left: 14px;
}
.outline-content li:has(.ty-outline-hit) *::before,
.outline-content li:has(.ty-outline-hit) *::after {
  content: '';
  display: none;
}
.outline-content li:has(.ty-outline-hit) .outline-item {
  margin-left: 1px !important;
  width: calc(100% - 1px);
  padding-left: 0 !important;
}
.outline-content li:has(.ty-outline-hit) .outline-item > .outline-label {
  padding: 8px 10px !important;
}

/*
 * --------------------------
 * file-library-list
 * file-library-search-result
 * --------------------------
*/
#file-library-list,
#file-library-search-result {
  padding: 14px;
}
/*ty-search-item*/
#file-library-list .file-list-item,
#file-library-search-result .ty-search-item {
  margin-bottom: 8px;
  border: 1px solid transparent;
  border-bottom-color: var(--border-color);
}
#file-library-list .file-list-item {
  padding-left: 14px;
  padding-right: 14px;
}

#file-library-list .file-list-item.active,
#file-library-search-result .ty-search-item.active {
  border-radius: 5px;
  border: 1px solid var(--color-1);
}
#file-library-list .file-list-item.active {
  padding: 6px 12px;
}
#file-library-search-result .ty-search-item.active {
  padding: 6px 12px 6px 0;
}
#file-library-list .file-list-item:first-of-type.active,
#file-library-search-result .ty-search-item:first-of-type.active {
  margin-top: 0;
}
#file-library-list .file-list-item:hover,
#file-library-search-result .ty-search-item:hover {
  border-radius: 5px;
  background: var(--bg-color2);
  border-color: var(--border-color);
}
#file-library-list .file-list-item:hover {
  color: var(--color-1);
}
#file-library-list .file-list-item:hover + .file-list-item:not(.active),
#file-library-list .file-list-item.active + .file-list-item:not(.active),
#file-library-search-result .ty-search-item:hover + .ty-search-item:not(.active),
#file-library-search-result .ty-search-item.active + .ty-search-item:not(.active) {
  border-top: 1px solid var(--border-color);
}
#file-library-list .file-list-item.active:hover,
#file-library-search-result .ty-search-item.active:hover {
  border-color: var(--color-1);
}

#file-library-search-result .ty-search-item.active {
  color: var(--text-color);
}
#file-library-search-result .ty-search-item.active .ty-search-item-line {
  white-space: pre-wrap;
  word-break: break-word;
}
.file-list-item-time {
  margin-right: 0;
  padding-right: 0;
}
.file-list-item-count {
  margin-right: 0;
  border-radius: 3px;
  padding: 0 6px;
}
#file-library-search-result .ty-search-item.active .file-list-item-count {
  padding-right: 0;
}
#sidebar-loading-template {
  display: none;
  margin-bottom: 5px;
  border-radius: 5px;
  padding: 8px;
}
.ty-file-search-match-text {
  background-color: var(--color-2-0-c);
}

/*
 * ------------------------
 * file-library-tree
 * ------------------------
*/
#file-library-tree {
  box-sizing: border-box;
  padding-top: 8px;
  padding-left: 14px;
  padding-right: 14px;
}
.file-node-root {
  position: relative;
  margin-left: 0 !important;
  padding-left: 0 !important;
}
.file-tree-node {
  margin-bottom: 1px;
}
.file-node-children {
  margin-left: 12px;
}
.file-node-root > .file-node-children {
  margin-left: -2px;
}
.file-tree-node > .file-node-content > .file-node-open-state + .file-node-icon {
  margin-left: 4px;
}
.file-node-expanded > .file-node-content > .file-node-open-state + .file-node-icon,
.file-node-collapsed > .file-node-content > .file-node-open-state + .file-node-icon {
  margin-left: 3px;
}
.fa-folder:before,
.fa-folder:after,
.fa-caret-right,
.fa-caret-down {
  color: var(--text-grey);
}
.file-node-content .file-node-open-state {
  position: relative;
  padding-left: 3px;
}
.file-node-expanded .file-node-content .file-node-open-state {
  padding-left: 3px;
}
.file-node-content .file-node-open-state::after {
  content: "";
  position: absolute;
  z-index: 20;
  left: 0;
  top: -21px;
  width: 8px;
  height: 32px;
  border-left: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
  background: transparent;
}
.file-node-expanded > .file-node-content .file-node-open-state::after {
  left: -12px;
  top: -21px;
  width: 7px;
}
.file-node-root > .file-node-content .file-node-open-state::after {
  display: none;
}
.file-tree-node:first-child > .file-node-content .file-node-open-state::after {
  top: -11px;
  height: 22px;
}
.file-node-expanded:first-child > .file-node-content .file-node-open-state::after {
  top: -11px;
}
.file-tree-node:last-child > .file-node-content .file-node-open-state::after {
  border-bottom-left-radius: 3px;
}
.file-node-collapsed > .file-node-content .fa-caret-right {
  margin-left: 9px;
}
.file-node-expanded {
  margin-left: 8px;
  border-left: 1px solid var(--border-color);
}
.file-tree-node:last-child {
  border-left-color: transparent;
}
.file-node-expanded > .file-node-content {
  margin-left: 3px;
}
.file-node-root > .file-node-content {
  margin-left: 0;
}
.file-node-content {
  position: relative;
  padding-top: 3px;
}
.file-node-content::after {
  content: '';
  display: none;
  position: absolute;
  z-index: -1;
  left: 6px;
  top: 0;
  width: calc(100% - 10px);
  height: 29px;
  background: var(--bg-color2);
  border-radius: 5px;
}
.file-library-file-node:hover > .file-node-content::after,
.file-tree-node.active > .file-node-content::after {
  display: block;
}
.file-library-file-node:hover > .file-node-content > .file-node-open-state:after,
.file-tree-node.active > .file-node-content > .file-node-open-state:after {
  width: 6px;
}
.file-node-background {
  display: none !important;
}
.file-library-node:not(.file-node-root):focus > .file-node-content {
  outline: none;
}

/*
 * ------------------------
 * TOC md-toc
 * ------------------------
*/
.md-toc {
  margin: 16px 0 0 0;
  font-size: 14px;
}
.md-toc-content {
  position: relative;
  margin: 0 0 0 3px;
  padding: 0;
}
.md-toc-content:before {
  content: '';
  position: absolute;
  left: 0;
  top: 12px;
  width: 1px;
  height: calc(100% - 30px);
  border-left: 1px solid var(--border-color);
}
.md-toc:focus .md-toc-content {
  margin: 0 !important;
  border: none !important;
}
.md-toc-content .md-toc-item {
  position: relative;
  padding-bottom: 8px;
}
.md-toc-content .md-toc-item:before {
  content: '';
  position: absolute;
  top: 8px;
  left: -2px;
  width: 5px;
  height: 5px;
  background: var(--border-color);
  border-radius: 50%;
}
.md-toc-content .md-toc-h1::before {
  background: var(--color-1);
}
.md-toc-item a.md-toc-inner:hover {
  text-decoration: none;
}
.md-toc-item:has(a.md-toc-inner:hover)::before {
  background: var(--color-2);
}
.md-toc-item a.md-toc-inner:hover code {
  background: var(--color-2-0-a);
  color: var(--color-2);
}
.md-toc-item a {
  padding-left: 18px !important;
}


#write div.md-toc-tooltip {
  z-index: 100;
  top: -52px;
  border-top: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
  padding: 3px 0;
}
.md-toc-content .md-toc-h1 a {
  padding-left: 20px;
}
#write div.md-toc-tooltip .md-delete-toc {
  margin: 0 !important;
  padding: 0 10px;
  background: var(--bg-color);
}
#write div.md-toc-tooltip .md-delete-toc:hover {
  background: var(--bg-color2);
  color: var(--color-1);
}

/*
 * ------------------------
 * code colors
 * ------------------------
*/
.cm-s-inner {
  background-color: transparent !important;
  color: var(--text-code);
}
.cm-s-inner .CodeMirror-gutters {
  border-right-color: var(--border-color);
  color: var(--text-code);
}
.cm-s-inner .CodeMirror-guttermarker,
.cm-s-inner .CodeMirror-guttermarker-subtle,
.cm-s-inner .CodeMirror-linenumber {
  color: var(--md-char-color);
}
.cm-s-inner .CodeMirror-cursor {
  border-left: 1px solid var(--border-color);
}
.cm-s-inner div.CodeMirror-selected,
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected,
.cm-s-inner .CodeMirror-line::selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--color-2-0-c);
}
.cm-s-inner .CodeMirror-activeline-background { background: transparent; }
.cm-s-inner .cm-keyword { color: #bb59fd; }
.cm-s-inner .cm-operator { color: #40d7ec; }
.cm-s-inner .cm-variable { color: #f4395dff; }
.cm-s-inner .cm-variable-2 { color: #e2785f; }
.cm-s-inner .cm-variable-3 { color: #6083ff; }
.cm-s-inner .cm-builtin { color: #f61d78; }
.cm-s-inner .cm-atom { color: #fa5336; }
.cm-s-inner .cm-number { color: #f59102; }
.cm-s-inner .cm-def { color: #3876eb; }
.cm-s-inner .cm-string { color: #02be74; }
.cm-s-inner .cm-string-2 { color: #0a790a; }
.cm-s-inner .cm-comment,
.cm-s-inner .cm-meta { color: var(--md-char-color); }
.cm-s-inner .cm-attribute { color: #c08b01; }
.cm-s-inner .cm-property { color: #1b9f72; }
.cm-s-inner .cm-qualifier { color: #dc7b45; }
.cm-s-inner .cm-tag { color: #e32e73; }
.cm-s-inner .cm-tag.cm-bracket {color: #0c9bd3;}
.cm-s-inner .cm-header, .cm-s-inner.cm-header {color: #41cce9;}
.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: var(--text-code) !important;
}
/* apply to code fences with plan text*/
.md-fences {
  background-color: var(--bg-color2);
  color: var(--text-grey);
}
.md-fences .code-tooltip {
  z-index: 50;
  right: 0 !important;
  bottom: -28px !important;
  padding: 0;
  border-radius: 5px;
  background-color: var(--bg-color2);
  color: var(--text-color);
}
.md-fences .code-tooltip input,
.md-fences .code-tooltip span {
  margin: 0;
  padding: 3px;
  border-radius: 5px;
}

/**
 * --------------------------------------
 * unibody-window
 * Control UI on Windows/Linux (optional)
 * --------------------------------------
*/
.unibody-window #write ul,
.typora-export #write ul {
  padding-left: 34px;
}
.unibody-window #write ol,
.typora-export #write ol {
  padding-left: 36px;
}
.unibody-window #write ul ul,
.unibody-window #write ol ol,
.unibody-window #write ul > li > ol,
.unibody-window #write ol > li > ul,
.typora-export #write ul ul,
.typora-export #write ol ol,
.typora-export #write ul > li > ol,
.typora-export #write ol > li > ul {
  margin-left: 0;
}
.unibody-window #write ul > li > p {
  margin: 0;
}
.unibody-window #write ol > li > p,
.typora-export #write ol > li > p {
  margin: 0 0 0 -2px;
}
.unibody-window #write ul > .task-list-item > input,
.typora-export #write ul > .task-list-item > input {
  margin-left: -22px;
}
.unibody-window .long-btn {
  border-radius: 8px !important;
}

/* .dropdown-menu */
.dropdown-menu {
  margin-top: 4px;
  padding: 8px !important;
  border-radius: 8px !important;
  border: 1px solid var(--border-color);
}
#recent-file-panel-search-input,
.megamenu-menu-panel .btn,
.dropdown-menu li a,
.dropdown-menu li:hover {
  border-radius: 5px !important;
}
.ty-spell-check-panel-item {
  margin-bottom: 4px;
  border-radius: 5px;
}
.btn-split-group .dropdown-menu {
  margin-top: 0;
}

.dropdown-menu li a {
  font-size: 14px;
}
.dropdown-menu table th,
.dropdown-menu table td {
  padding: 5px !important;
}
.dropdown-menu li:hover > a,
.dropdown-menu li > span > a:hover,
#sidebar-files-menu li:hover > a,
#close-sidebar-menu-btn:hover {
  background: var(--bg-color2) !important;
  color: var(--color-1) !important;
}
.dropdown-menu li > span > a:hover {
  background: var(--color-1-0-b) !important;
  box-shadow: inset 0 0 0 1px var(--color-1), inset 0 -1px 0 var(--color-1);
}
.dropdown-menu li.file-action-item,
.dropdown-menu li.file-sort-item,
.dropdown-menu li.file-sort-item + li {
  margin-top: 0;
  border-radius: 0 !important;
}

/* .toolbar-icon */
.unibody-window .long-btn:hover span,
.unibody-window .long-btn:hover i,
.megamenu-menu-panel .btn:hover,
#megamenu-menu-header-title:hover,
.toolbar-icon:hover,
#megamenu-back-btn:hover i {
  color: var(--color-1);
  text-decoration: none;
}
.unibody-window .long-btn:hover,
.megamenu-menu-panel .btn:hover,
#megamenu-back-btn:hover {
  border-color: var(--color-1);
  background: var(--bg-color2);
}
#w-titlebar-left {
  margin-top: 3px;
}
#w-traffic-lights span {
  background: transparent !important;
  border-radius: 0 !important;
  border: none !important;
}
#w-traffic-lights .btn {
  margin: 0 !important;
}
#w-traffic-lights #w-min,
#w-traffic-lights #w-close,
#w-traffic-lights #w-max {
  padding-top: 8px;
  padding-left: 18px;
}
#w-traffic-lights #w-close {
  border-top-right-radius: 8px !important;
}
#w-max-group.w-show-more > #w-full,
#w-max-group.w-show-more > #w-pin {
  display: block !important;
  background: var(--bg-color2) !important;
}
#w-max-group *,
#w-max-group.w-show-more > #w-full *,
#w-max-group.w-show-more > #w-pin * {
  color: var(--text-color) !important;
}
#w-max-group.w-show-more > #w-pin {
  border-bottom-left-radius: 5px !important;
  border-bottom-right-radius: 5px !important;
}
#w-traffic-lights > span:not(#w-close):hover {
  background: var(--bg-color2) !important;
  color: var(--text-color);
}
#w-traffic-lights #w-close:hover {
  background: var(--color-5) !important;
  color: white !important;
}
#w-max-group.w-show-more > #w-full:hover *,
#w-max-group.w-show-more > #w-pin:hover * {
  color: var(--color-1) !important;
}

/*  #megamenu-content, #megamenu-menu-sidebar */
.unibody-window #megamenu-menu-sidebar {
  --bg-color: #1b1b1f;
  --bg-color2: rgb(40, 42, 50);
  --border-color: rgb(60, 62, 70);
  background: var(--bg-color);
  border-right: 1px solid var(--border-color);
  overflow: hidden;
}
#megamenu-menu-sidebar .megamenu-menu-list {
  border: none;
}
.megamenu-section {
  margin-top: 12px;
}
.megamenu-menu-panel h1 {
  margin-top: 32px;
  margin-bottom: 32px;
  font-size: 30px;
  line-height: 30px;
}
#megamenu-section-about h1 {
  text-align: center;
}
.megamenu-menu-panel h2 {
  font-size: 26px;
  line-height: 26px;
}
.megamenu-menu-panel .btn {
  padding: 6px 12px;
}
.megamenu-menu-panel .long-btn {
  padding: 10px 12px;
  text-align: center;
}
.megamenu-content {
  padding-right: 30px;
  padding-top: 26px;
  background: var(--bg-color);
}
.megamenu-menu-panel #recent-file-panel .dropdown-menu {
  margin-top: 4px;
}
#open-theme-folder-btn {
  margin-top: 32px;
}
.megamenu-menu-header {
  border-color: var(--border-color);
}
.megamenu-menu-header #megamenu-back-btn {
  margin-left: 10px;
  border-radius: 6px;
  border-width: 2px;
}
.megamenu-menu-header #megamenu-back-btn > i {
  display: block;
  font-size: 16px;
  line-height: 28px;
}
.megamenu-menu-header #megamenu-menu-header-title:hover {
  color: var(--color-1);
}
#megamenu-menu-list {
  padding: 0 8px;
}
.megamenu-menu-list li {
  margin-top: 6px;
}
.megamenu-menu-list li a {
  display: block;
  border-radius: 5px;
  border: 1px solid transparent;
  font-size: 16px;
  line-height: 34px;
}
.megamenu-menu-list li a .fa {
  display: inline-block;
  margin-left: 0;
  margin-right: 0;
  opacity: 1;
  font-size: 18px;
  line-height: 38px;
}
.megamenu-menu-list li a .fa + span {
  margin-left: 14px;
}
.megamenu-menu-list li #m-saved .fa {
  font-size: 20px;
  line-height: 36px !important;
  color: var(--color-1);
}
.megamenu-menu-list li a:hover,
.megamenu-menu-list li a.active:hover {
  background: var(--bg-color2) !important;
  border: 1px solid var(--color-1);
  color: var(--color-1) !important;
}
.megamenu-menu-list li a.active {
  background: var(--bg-color2);
  color: var(--color-1) !important;
}
@media (max-width: 768px) {
  #megamenu-back-btn {
    margin-left: 0 !important;
  }
  .dropdown-menu {
    padding: 8px !important;
  }
}
#recent-file-panel-action-btn-container {
  margin-right: 0;
}
#recent-file-panel-search-input {
  width: calc(100% - 55px);
}

#megamenu-clear-recet-documents {
  background: var(--bg-color2);
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 14px;
}
#megamenu-clear-recet-documents:hover {
  color: var(--color-1);
}
.ty-show-search #info-panel-tab-search .info-panel-tab-border,
.ty-show-search #info-panel-tab-search .info-panel-tab-border,
.active-tab-files #info-panel-tab-file .info-panel-tab-border,
.active-tab-outline #info-panel-tab-outline .info-panel-tab-border {
  height: 3px;
  border-radius: 2px;
}
.megamenu-menu-panel {
  scrollbar-width: none !important;
}
#theme-preview-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
  justify-content: space-between;
  grid-gap: 32px;
  max-width: 100%;
}
@media (max-width: 1440px) {
  #theme-preview-grid {
    grid-template-columns: 1fr 1fr 1fr 1fr;
  }
}
@media (max-width: 1200px) {
  #theme-preview-grid {
    grid-template-columns: 1fr 1fr 1fr;
  }
}
@media (max-width: 992px) {
  #theme-preview-grid {
    grid-template-columns: 1fr 1fr;
  }
}
@media (max-width: 768px) {
  #theme-preview-grid {
    grid-template-columns: 1fr;
  }
}
.theme-preview-div {
  margin: 0;
  box-sizing: border-box;
  overflow: hidden;
  padding: 5px;
  border: 3px solid var(--border-color);
  border-radius: 10px;
  color: var(--color-1);
}
.theme-preview-content {
  width: 100%;
  height: 100%;
  border-radius: 6px;
}
.theme-preview-div:hover {
  border-color: var(--color-2);
}
.theme-preview-div.active {
  border-color: var(--color-1);
}
.theme-preview-div .fa,
#outline-btn:hover {
  color: var(--color-1) !important;
}

/* context menu */
.context-menu {
  padding: 6px !important;
  border-radius: 6px !important;
  border: 1px solid var(--border-color);
}
.ext-context-menu {
  margin: -4px 1px 0 1px;
}
.context-menu li a {
  display: inline-block;
  width: 100%;
  border-radius: 6px !important;
}
.context-menu > .active a {
  color: var(--color-1) !important;
}
.tb43e-d6bd-dbe4y {
  background: var(--bg-color2);
}

/*
 * ------------------------
 * UI-controls
 * dialogs
 * ------------------------
*/
.form-control {
  padding: 6px;
}

/* alert-msg */
#searchpanel-msg {
  margin-top: 2px;
  margin-bottom: 8px;
  background: var(--color-1-0-a);
}
.alert.alert-warning,
.alert.alert-warning * {
  color: var(--color-1) !important;
}
#md-searchpanel {
  padding-top: 7px;
}
#md-searchpanel input,
#md-replace-type-label,
#search-panel-replace-btn,
.modal-dialog,
.modal-title,
.modal-content {
  border-radius: 5px;
}
.modal-content {
  padding: 8px;
  border-radius: 8px;
}
#sidebar-files-menu li a {
  padding-top: 5px;
  padding-bottom: 5px;
}
#sidebar-files-menu .file-action-item {
  line-height: 30px;
}
.ty-sidebar-search-panel {
  padding-left: 14px !important;
  padding-right: 14px !important;
}
#file-library-search-panel {
  padding-top: 3px;
  padding-bottom: 11px;
  border-bottom: 1px solid var(--border-color) !important;
}
#file-library-search-input {
  top: 4px;
  width: 100% !important;
  border-radius: 0 !important;
}
#file-library-search-input,
.native-window #file-library-search-input {
  height: 28px;
  border-radius: 5px !important;
  font-size: 12px;
}
#ty-sidebar-search-panel .searchpanel-search-option-btn {
  top: 12px;
}
#close-outline-filter-btn {
  top: 12px;
  right: 15px;
  border: none !important;
  background: transparent !important;
}
#sidebar-content #file-library-search-panel .searchpanel-search-option-btn {
  top: 12px;
}


/* #root .window */
.window,
.window label {
  font-size: 13px !important;
}
.window .window-header h2 {
  font-size: 15px !important;
}
.window .nav-group-item {
  margin: 14px 0;
  font-size: 15px !important;
}
.window pre {
  padding: 16px;
}
#ty-tooltip,
.ty-tooltip.shown {
  padding: 6px 12px;
  background: var(--bg-color2);
  border-radius: 6px;
  color: var(--text-color);
}

/* content footer */
footer.ty-footer,
.ty-footer .footer-item {
  height: 24px;
  border-top: none;
}
.ty-footer .footer-item {
  margin-left: 3px;
  margin-top: -5px;
  border-radius: 5px;
  background: var(--border-color) !important;
  line-height: 24px;
}
.ty-footer #footer-word-count {
  margin-right: -2px;
}
.typora-sourceview-on #toggle-sourceview-btn {
  margin-left: 0;
}
#dict-install-dialog + div {
  bottom: 3px !important;
}
#footer-word-count-info {
  padding: 6px;
  border-radius: 5px;
  border: 1px solid var(--border-color);
}
#footer-word-count-info table {
  border-radius: 0;
}
#footer-word-count-info table tr > td:first-of-type {
  border-top-left-radius: 5px;
  border-bottom-left-radius: 5px;
}
#footer-word-count-info table tr > td:last-of-type {
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
}
.export-item.active,
.export-items-list-control {
  border-radius: 3px !important;
}
.nav-group-item {
  border-radius: 6px !important;
}
.input-group table,
.export-detail {
  border-radius: 6px !important;
}
.export-detail .file-input input {
  height: 30px !important;
  padding-left: 8px !important;
  border-color: var(--border-color) !important;
}
.search-input {
  padding: 6px 12px !important;
  border-color: var(--border-color) !important;
}
.label-input-group div {
  margin: 0 !important;
  padding: 0 !important;
  border: none !important;
}
.label-input-group div pre {
  border-radius: 6px !important;
  font-size: 14px !important;
}
.input-group-content {
  border-radius: 6px !important;
}
.input-group-content table {
  margin-top: 4px;
}
.label-hint svg {
  margin-right: 3px;
}
.export-detail .input-group-content > .row {
  margin-right: 16px;
}
.export-detail,
.export-item.active,
.export-items-list-control {
  background: var(--bg-color2) !important;
}
.export-item.active {
  color: var(--color-1) !important;
}
.md-show-hint::after {
  background: var(--bg-color2) !important;
  border-radius: 3px;
  box-shadow: 0 0 3px var(--color-1) !important;
}
/**
 * ---------------------------------
 * Control UI on Mac (optional)
 * ---------------------------------
*/
.sidebar-tab-btn {
  margin-top: 12px !important;
  color: var(--title-color);
  font-size: 16px !important;
  line-height: 20px !important;
  vertical-align: middle;
}
.sidebar-tab-btn:hover {
  color: var(--color-1);
}
.mac-os .ty-show-search .ty-tab-wrapper {
  border-bottom: 1px solid var(--border-color);
}
.mac-os #sidebar-search-btn span::before {
  font-size: 18px;
}
.mac-os #ty-sidebar-search-tabs input {
  top: 0;
  margin-right: 0;
  padding: 0;
  border-top: none;
  border-right: none;
  border-left: none;
  border-radius: 0 !important;
  border-bottom-width: 1px;
}
.mac-os #ty-sidebar-search-tabs .searchpanel-search-option-btn {
  top: 14px;
}
.mac-os #ty-sidebar-search-tabs #ty-sidebar-search-back-btn {
  margin-top: 14px !important;
}
.mac-os #ty-sidebar-search-tabs .sidebar-tab-btn {
  width: 25px !important;
  padding-right: 8px;
}
.mac-os #ty-sidebar-search-tabs #filesearch-regexp-option-btn {
  right: 12px;
}
.mac-os #ty-sidebar-search-tabs #filesearch-word-option-btn {
  right: 35px;
}
.mac-os #ty-sidebar-search-tabs #filesearch-case-option-btn {
  right: 58px;
}
#ty-sidebar-footer .sidebar-footer-item {
  padding-top: 4px;
  padding-bottom: 4px;
}
.os-windows #ty-sidebar-footer .sidebar-footer-item {
  padding-top: 0;
  padding-bottom: 0;
}

#typora-quick-open {
  padding: 12px;
  background-color: var(--bg-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
}
.typora-quick-open-item,
.md-hover-tip .code-tooltip-content {
  border-radius: 5px;
  overflow-x: auto;
}
.code-tooltip.md-hover-tip,
.md-hover-tip .code-tooltip-content,
.md-arrow::after {
  border-bottom-color: var(--color-1) !important;
  background: var(--color-1) !important;
  box-shadow: 0 1px 4px var(--color-1) !important;
}
.md-hover-tip .code-tooltip-content:hover a {
  color: var(--color-2) !important;
}

/*
 * ------------------------
 * .ty-preferences
 * ------------------------
*/
.sidebar {
  position: relative;
}
.sidebar:after {
  content: '';
  display: block;
  position: absolute;
  width: 1px;
  height: 100%;
  right: -24px;
  top: 0;
  border-left: 1px solid var(--border-color);
}

.ty-preferences a {
  font-size: 12px !important;
  text-decoration: none;
  color: var(--color-1);
}
.ty-preferences a:hover {
  text-decoration: underline;
  color: var(--color-2);
}

/*search style*/
#searchpanel-search-group .ty-search-panel-row {
  padding-top: 0;
}
#searchpanel-search-group .searchpanel-search-option-btn {
  top: 3px;
  background: var(--bg-color);
}
#searchpanel-search-group .searchpanel-search-option-btn:hover {
  color: var(--color-1);
}
.ty-search-panel-row .btn {
  line-height: 14px;
}
.ty-search-panel-row .ion-close-round,
.ty-search-panel-row .ty-upload {
  padding-right: 8px !important;
  padding-left: 4px !important;
}
#search-panel-next,
#search-panel-replace-btn {
  left: 3px;
}
#search-panel-replaceall-btn,
#search-panel-replace-btn {
  padding-right: 4px !important;
  padding-left: 4px !important;
  text-align: center !important;
}
.ty-on-outline-filter .ty-outline-hit {
  color: var(--color-2);
}
.md-search-hit {
  background: var(--color-2-0-c) !important;
  color: #070909 !important;
}
.md-search-select {
  background: var(--color-2) !important;
  color: #070909 !important;
}

/* md-notification-container */
.md-notification-container {
  padding-top: calc(var(--title-bar-height) + 10px) !important;
  background: var(--bg-color);
  border-bottom: 1px solid var(--border-color);
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.15), 0 2px 5px 0 rgba(0, 0, 0, 0.1);
  font-size: 14px;
}
.native-window.os-windows .md-notification-container,
.mac-os .md-notification-container {
  padding-top: 1px !important;
}
.md-notification-container #md-notification::before {
  top: 8px;
  font-size: 16px;
}
#md-notification .md-notification-content {
  padding-bottom: 4px;
}
#md-notification p {
  margin: 4px 0;
  white-space: nowrap;
}
#md-notification > p:last-of-type {
  margin-bottom: 8px;
}
#md-notification > p:only-of-type {
  margin-bottom: 0;
}
.md-notification-container .btn {
  margin: 0;
}
#md-notification .typora-search-spinner,
#md-notification .typora-export-spinner {
  top: 5px !important;
}
.unibody-window #md-searchpanel .btn {
  line-height: 24px !important;
}
#md-notification .typora-search-spinner > div,
#md-notification .typora-export-spinner > div {
  background: var(--color-1);
}

/* 打字机模式提示 */
#md-notification .ty-enter-mode-warning-body + div {
  display: flex;
  display: -webkit-flex;
}
#md-notification label {
  align-self: center;
}
#md-notification label > input {
  margin-top: 0;
}

/*
 * ------------------------
 * diagram
 * ------------------------
*/
.md-diagram .md-diagram-panel {
  border-radius: 8px;
  border-color: transparent !important;
  background: var(--bg-color2);
}
pre.md-focus .md-diagram-panel {
  margin-top: 4px;
}

/*
 * ------------------------
 * export html
 * ------------------------
*/
body.typora-export {
  padding: 0;
}
.typora-export code {
  padding: 2px 4px;
}
.typora-export .typora-export-content {
  display: flex;
  display: -webkit-flex;
  width: 100vw;
  max-width: 1920px;
  margin: 0 auto;
  justify-content: center;
}
.typora-export #write {
  margin: 0;
}

/* sidebar */
#typora-sidebar {
  border-right-color: var(--border-color);
}
.typora-export-sidebar {
  margin-right: 0;
  margin-top: 0;
}
.typora-export-sidebar > .outline-content {
  height: 100vh;
  border-right: 1px solid var(--border-color);
  padding-top: 14px;
  padding-bottom: 14px;
  overflow: auto;
}
.no-collapse-outline .typora-export-sidebar .outline-item-wrapper > ul li,
.typora-export-sidebar .outline-item-open > ul li {
  margin-left: 1px;
}
.typora-export-no-collapse-outline .outline-expander {
  display: none;
}
.typora-export-no-collapse-outline .outline-item-wrapper > .outline-children::before {
  content: '';
  position: absolute;
  left: -24px;
  top: -20px;
  width: 1px;
  height: calc(100% + 12px);
  background: transparent;
  border-left: 1px solid var(--border-color);
}
.typora-export-no-collapse-outline .outline-content li ul {
  margin-left: 21px;
}
.typora-export-no-collapse-outline .outline-item-wrapper:last-of-type > .outline-children::before,
.typora-export-no-collapse-outline .outline-children > li.outline-item-wrapper:last-child > .outline-children::before {
  display: none;
}
.typora-export-no-collapse-outline .outline-children > li:first-child > .outline-item::before,
.typora-export-no-collapse-outline .outline-content > li:nth-child(2) > .outline-item::before {
  top: -9px;
  height: calc(50% + 9px);
}
.typora-export-no-collapse-outline .outline-content > li.outline-item-wrapper:first-child > .outline-children::before {
  top: -15px;
}
.typora-export .outline-expander::before,
.typora-export .outline-expander:hover::before,
.no-collapse-outline .typora-export .outline-item-wrapper > .outline-item > .outline-expander::before,
.typora-export .outline-item-open > .outline-item-wrapper > .outline-expander::before {
  content: "" !important;
  width: 7px;
  height: 7px;
  box-sizing: border-box;
  padding: 0;
  background: transparent;
  border-top: 1.5px solid var(--text-color);
  border-right: 1.5px solid var(--text-color);
  z-index: 50;
}
.typora-export .outline-item-wrapper > .outline-item > .outline-expander::before,
.typora-export .outline-item-wrapper:not(.outline-item-open) > .outline-item > .outline-expander::before {
  margin-top: 13px;
  transform: rotate(45deg);
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
}
.typora-export .outline-expander:hover::before,
.typora-export .outline-item-wrapper:not(.outline-item-open) > .outline-item > .outline-expander:hover::before,
.typora-export .outline-item-open > .outline-item > .outline-expander::before {
  margin-left: 2px;
  margin-top: 11px;
  -webkit-transform: rotate(135deg);
  -ms-transform: rotate(135deg);
}
.typora-export .outline-expander:hover::before {
  margin-left: -2px;
}
.typora-export .outline-item:hover {
  margin-right: 0;
}
.typora-export .outline-item-active {
  background: transparent !important;
}
.typora-export .outline-item-active > .outline-item,
.typora-export .outline-item-active > .outline-item > .outline-label {
  background: var(--bg-color2) !important;
  color: var(--color-1);
}
.typora-export .outline-content li .outline-label {
  padding-left: 9px;
}
.typora-export li.outline-item-open > .outline-item > .outline-label,
.typora-export .outline-item-wrapper:not(.outline-item-open) > .outline-item > .outline-expander:hover + .outline-label {
  padding-left: 13px;
}
.typora-export-no-collapse-outline .outline-content li .outline-label {
  padding-left: 0 !important;
}
.typora-export .outline-item:hover .outline-label {
  color: var(--text-color);
}
.typora-export-sidebar .outline-content li > .outline-item:hover > .outline-expander::before {
  border-color: var(--text-color);
}
.typora-export-sidebar .outline-item-active > .outline-item > .outline-expander::before {
  border-width: 2px !important;
  border-color: var(--color-1);
}

/*
 * ------------------------
 * @media screen
 * ------------------------
*/
@media screen and (min-width: 1921px) {
  .typora-export-show-outline #write {
    max-width: 1312px;
    padding-right: 0;
  }
}

@media screen and (min-width: 1725px) {
  .typora-export .outline-content {
    padding-left: 5px;
  }
}

@media screen and (max-width: 1724px) {
  .typora-export-show-outline #write {
    max-width: 1672px;
  }
  #write,
  #typora-source .CodeMirror-lines,
  .typora-export-show-outline #write {
    padding: 32px 96px;
  }
  .typora-export-sidebar,
  .typora-export-sidebar > .outline-content {
    width: 280px;
  }
}

@media screen and (max-width: 1440px) {
  .typora-export-show-outline #write {
    max-width: 1620px;
  }
  #write,
  #typora-source .CodeMirror-lines,
  .typora-export-show-outline #write {
    padding: 32px 80px;
  }
  .typora-export-sidebar,
  .typora-export-sidebar > .outline-content {
    width: 260px;
  }
}

@media screen and (max-width: 1200px) {
  .typora-export-sidebar,
  .typora-export-sidebar > .outline-content {
    width: 240px;
  }
  #write,
  #typora-source .CodeMirror-lines,
  .typora-export-show-outline #write {
    padding: 32px 80px;
  }
}

@media screen and (max-width: 992px) {
  .typora-export-sidebar,
  .typora-export-sidebar > .outline-content {
    display: block !important;
  }
  #write,
  #typora-source .CodeMirror-lines,
  .typora-export-show-outline #write {
    padding: 32px 60px;
  }
}

@media screen and (max-width: 768px) {
  .typora-export-sidebar {
    display: none !important;
  }
  #write,
  .typora-export-show-outline #write {
    padding: 32px;
  }
  h1.md-focus::before,
  h2.md-focus::before,
  h3.md-focus::before,
  h4.md-focus::before,
  h5.md-focus::before,
  h6.md-focus::before,
  h1::before,
  h2::before,
  h3::before,
  h4::before,
  h5::before,
  h6::before {
    left: -30px;
  }
}

/*
 * ------------------------
 * @media print
 * ------------------------
*/
@media print {
  html,
  body,
  body #write,
  body content,
  body .typora-export-content {
    margin: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    height: auto !important; /*解决浏览器打印只有一页问题*/
    padding: 0 !important;
    border: none !important;
  }
  body .typora-export-sidebar {
    display: none !important;
    width: 0 !important;
  }
  ::-webkit-scrollbar {
    width: 0 !important;
    height: 0 !important;
  }
  body,
  body * {
    scrollbar-width: none !important;
  }
  table,
  pre,
  img,
  blockquote,
  section,
  .md-alert{
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    margin: 24pt 0 12pt;
  }
  h1 {
    font-size: 24pt;
  }
  h2 {
    font-size: 21pt;
  }
  h3 {
    font-size: 18pt;
  }
  h4 {
    font-size: 15pt;
  }
  h5 {
    font-size: 13.5pt;
  }
  h6 {
    font-size: 12pt;
  }
  p {
    font-size: 12pt;
    margin: 12pt 0;
  }

  @page {
    margin: 15mm !important;
    size: auto;
    /*谷歌浏览器打印设置*/
    @top-center {
      content: '';
      font-size: 9pt;
    }
    @bottom-center {
      content: counter(page) '/' counter(pages);
      font-size: 9pt;
    }
  }
}</style>
<style type='text/css'  id="style-mathjax">
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG2"] path[data-c], mjx-container[jax="SVG2"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}
</style>
<style type='text/css'  id="style-mathjax-ni">mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
							stroke-width: 0;
						}</style>
<style type='text/css'  id="style-lp">ol, ul {padding-left: 40px}</style>
<title>Cpp中的虚表</title>
<meta name="time" content="20250521">
<meta name="keywords" content="Cpp, 汇编, 多态, 虚表, 继承">
<meta name="preface" content="带你一起探索Cpp虚表的魔力">

</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><p><img src="https://exstyty-1305069443.cos.ap-beijing.myqcloud.com//cover.png" alt="cover"></p><h1 id='cpp中的虚表'><span>CPP中的虚表</span></h1><p><span>谈到虚表, 自然而然的我们会想到cpp中&quot;继承与多态&quot;; Rust有意地弱化了面向对象的概念, 转而使用了 </span><strong><span>&quot;特征Trait&quot;</span></strong><span> 这一更&quot;扁平化&quot;的方式来描述多态. </span>
<span>今天我们先来谈谈Cpp中的多态:)</span></p><h3 id='c语言结构体的等号赋值操作'><span>c语言结构体的等号赋值操作</span></h3><p><span>由于CPP选择兼容C, 让我们先来观察C语言中对结构体的操作:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="c"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">struct</span> <span class="cm-def">Foo</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">c</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-variable">foo1</span>; <span class="cm-comment">// 定义全局foo1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">struct</span> <span class="cm-def">Foo</span> <span class="cm-def">foo2</span> <span class="cm-operator">=</span> {<span class="cm-number">6</span>, <span class="cm-string">'a'</span>, <span class="cm-number">10</span>}; <span class="cm-comment">// 创建另一个局部变量 foo2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">foo1</span> <span class="cm-operator">=</span> <span class="cm-variable">foo2</span>; <span class="cm-comment">// 使用foo2对foo1进行赋值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 269px;"></div><div class="CodeMirror-gutters" style="display: none; height: 269px;"></div></div></div></pre><p><span>这是一段很基础的代码, 但这已经足够, 我们来观察一下其在未开启优化时生成的汇编代码是如何的:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">foo1:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .zero &nbsp; 12</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>,<span class="cm-variable">sp</span>,-32</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sd</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span>,24(<span class="cm-variable">sp</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sd</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">s0</span>,16(<span class="cm-variable">sp</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-keyword">s0</span>,<span class="cm-variable">sp</span>,32</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#-------第一行👇------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,6</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-32(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,97</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sb</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-28(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,10</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-24(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#-------第二行👇------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">lui</span> &nbsp; &nbsp; <span class="cm-keyword">a5</span>,%hi(foo1)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span>,a5,%lo(foo1)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,-32(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sd</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,0(a5)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">lw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,-24(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,8(a5)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#-------------------</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,a5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span>,24(<span class="cm-variable">sp</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">s0</span>,16(<span class="cm-variable">sp</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-variable">sp</span>,<span class="cm-variable">sp</span>,32</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">jr</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 627px;"></div><div class="CodeMirror-gutters" style="display: none; height: 627px;"></div></div></div></pre><p><span>即使读不懂也没关系, 在这里快速的为你讲解一下: 首先略过asm中开头和结尾的代码, 只关注我们程序中</span><code>main</code><span>函数内的两行代码。第一行代码对应了6句asm代码, 每两句为一个组, 对应了为</span><code>foo2</code><span>结构体的三个赋值操作. 其中第一句</span><code>li a5,6</code><span>将某个立即数分配到一个寄存器上, 其中寄存器为</span><code>a5</code><span>, 立即数为</span><code>6</code><span>; 第二句代码</span><code>sw a5,-32(s0)</code><span>取</span><code>a5</code><span>上的1 word数据(1word = 4字节 = 32位)存放到目标地址</span><code>-32(s0)</code><span>中, 目前</span><code>s0</code><span>内是当前函数的栈底地址, </span><code>-32</code><span>代表从</span><code>s0</code><span>位置向下偏移32字节. 经过三组赋值操作后, 目前栈中的数据看起来是这样的:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+---------------------+ &lt;-- s0 (帧指针，原始栈顶 sp_before)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| saved ra &nbsp;  8bytes &nbsp;  | s0-8 到 s0-1 对应24(sp)  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| --------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| saved s0 &nbsp;  8bytes &nbsp;  | s0-16 到 s0-9 对应16(sp) |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| --------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| padding &nbsp; &nbsp; 4bytes &nbsp;  | s0-20 到 s0-17 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| --------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| local foo2  12bytes &nbsp; | s0-32 到 s0-20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+---------------------+ &lt;-- 当前栈顶 sp = s0-32</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><p><span>其中</span><code>foo2</code><span>内的数据排列为:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------------+  \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| int y = 10 &nbsp; 4bytes | &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ------------------- | &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| padding &nbsp; &nbsp;  3bytes | &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ------------------- | &nbsp; | --&gt; 12 bytes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| char c = 'a' 1bytes | &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ------------------- | &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| int x = 6 &nbsp;  4bytes | &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------------+  /</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 202px;"></div><div class="CodeMirror-gutters" style="display: none; height: 202px;"></div></div></div></pre><blockquote><p><span>padding: </span>
<span>为了满足指令集的​内存对齐要求​, 这里为8字节对齐.</span></p></blockquote><p><span>之前我们略过的开头和结尾的代码, 实际上这部分代码为编译器自动插入的用来保存(还原)需要</span><strong><span>被调用者函数</span></strong><span>保存(还原)的寄存器内的数据, 函数的返回地址(比如main函数调用fucA后的下一条指令), 保存(恢复)</span><strong><span>调用者函数</span></strong><span>的栈帧基址, 以及分配(释放)函数栈帧的代码. 由 </span><code>addi sp,sp,-32</code><span> 可知asm指令为当前</span><code>main</code><span>函数分配了一个大小为32字节的栈帧(立即将栈指针寄存器地址向下偏移32个字节)</span></p><blockquote><p><span>函数调用约定: </span>
<span>在&quot;函数调用另一个函数&quot;这一动作发生时, 产生了调用者和被调用者两个角色, 两个角色有着各自的职责, 比如调用者函数如何向被调用者传递参数, 被调用者如何返回值, 调用双方如何保存当前程序的运行状态, 用以还原函数调用发生前的现场(保存函数调用发生前的寄存器状态).</span></p></blockquote><p><span>回到我们的主线上来, 需要关注的是第二行代码所对应的asm指令: 前两个指令将全局变量</span><code>foo1</code><span>的地址读取到寄存器</span><code>a5</code><span>当中; </span><code>ld a4,-32(s0)</code><span> 和 </span><code>sd a4,0(a5)</code><span>将以</span><code>s0</code><span>下偏移32字节处为基址的double word数据(8字节数据)加载至</span><code>a4</code><span>寄存器中, 并存放到</span><code>a5</code><span>寄存器内地址位置处。这实际上是将当前栈帧内的</span><code>foo2.x</code><span> 和 </span><code>foo3.c with padding</code><span> 复制到了全局变量</span><code>foo1.x</code><span> 和</span><code>foo2.c with padding</code><span>位置处, 之后以同样的方式将</span><code>foo2.y</code><span> 复制到了 </span><code>foo1.y</code><span>位置处。值得一提的是</span><code>foo1</code><span>可能位于数据段</span><code>.bss</code><span>内, 该数据段一般存放全局的还未初始化的数据.</span></p><blockquote><p><span>抽象化的地址空间</span>
<span>需要澄清的是, 我们在编写代码时所考虑的stack, heap, .bss, .text等逻辑段在物理内存中并不存在(或者说并不一一对应), 原因在于操作系统为每一个应用都提供了一个</span><strong><span>抽象化且透明的</span></strong><span>地址空间, 逻辑段在该地址空间中是连续且一一对应的. 操作系统会进程分配一个</span><strong><span>页表</span></strong><span>, 将抽象化的地址空间中</span><strong><span>所被用到的地址</span></strong><span>各自映射到一个物理地址, 这一映射过程以</span><strong><span>页</span></strong><span>为单位, 由于不同的页转换到物理内存遵循着不同的线性映射, 所以逻辑段不连续于物理内存中. </span></p></blockquote><p><img src="https://exstyty-1305069443.cos.ap-beijing.myqcloud.com//page-table.png" alt="page-table"></p><p><span>由此我们得出, </span><strong><span>c语言中的结构体的等号赋值操作实际对应了1 : 1的内存复制指令</span></strong><span>. 这非常关键, 由于cpp要兼容于c, 所以我们大胆的推测: cpp中的拷贝构造对应了c语言中的1:1内存复制.</span></p><h3 id='cpp-中的单继承'><span>cpp 中的单继承</span></h3><p><span>以下是cpp中单继承的示例, 其中</span><code>Derived</code><span>类派生自</span><code>Base</code><span>类:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Base</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">base_var</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Base</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>) : <span class="cm-variable">base_var</span>(<span class="cm-variable">x</span>) {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">base_func</span>() {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-variable">b1</span>{<span class="cm-number">11</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Derived</span> : <span class="cm-keyword">public</span> <span class="cm-variable">Base</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Derived</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">y</span>) : <span class="cm-variable">Base</span>(<span class="cm-variable">x</span>), <span class="cm-variable">derived_var</span>(<span class="cm-variable">y</span>) {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">private</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">long</span> <span class="cm-variable-3">long</span> <span class="cm-variable-3">int</span> <span class="cm-variable">derived_var</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">derived_func</span>() {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Derived</span> <span class="cm-variable">d1</span> <span class="cm-operator">=</span> {<span class="cm-number">13</span>, <span class="cm-number">27</span>}; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">b1</span> <span class="cm-operator">=</span> <span class="cm-variable">d1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 470px;"></div><div class="CodeMirror-gutters" style="display: none; height: 470px;"></div></div></div></pre><p><span>我们在</span><code>main</code><span>函数中创建了一个局部变量派生类对象d1, 并使用拷贝构造的方式将它赋值给了局部变量基类b1, 其中发生了&quot;隐式的类型转换&quot;.</span></p><p><span>我们都知道, 在</span><code>d1</code><span>赋值给</span><code>b1</code><span>(也可以形象地但不准确地描述为</span><code>d1</code><span>转化为</span><code>b1</code><span>)后, 原本存在于d1中的成员变量和函数将不复存在, 无法再使用</span><code>b1.derived_var</code><span>来访问该值, 这其中又发生了什么呢?让我们来观察一下该段示例代码的汇编代码:</span></p><p><span>首先是</span><code>main</code><span>函数的片段:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span>,s0,-32</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a2</span>,27</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a1</span>,13</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,a5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">call</span> &nbsp; &nbsp;<span class="cm-builtin">_ZN7DerivedC1Eii</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 179px;"></div><div class="CodeMirror-gutters" style="display: none; height: 179px;"></div></div></div></pre><p><span>在该</span><code>main</code><span>函数片段中一共做了3件事情, 第1行和第4行确定了局部变量</span><code>d1</code><span>在</span><code>main</code><span>函数栈帧中的基地址, 存储至</span><code>a0</code><span>寄存器; 第2, 3行将</span><code>Derived</code><span>类的构造函数参数(两个立即数)添加至</span><code>a1</code><span>和</span><code>a2</code><span>中; 第5行则是调用</span><code>Derived</code><span>类的构造函数.</span></p><p><span>再来观察</span><code>Derived</code><span>类的构造函数的汇编指令代码片段:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">_ZN7DerivedC1Eii</span>:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a1</span>,a4</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,a5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">call</span> &nbsp; &nbsp;<span class="cm-builtin">_ZN4BaseC2Ei</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-24(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">lw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,-32(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sd</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,8(a5)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 224px;"></div><div class="CodeMirror-gutters" style="display: none; height: 224px;"></div></div></div></pre><p><span>该片段中, 从上一步骤中的3个参数(参数</span><code>13</code><span>, 参数</span><code>27</code><span>, 构建局部变量的基地址)中取出了其中两个: 父类构造函数所需的参数</span><code>13</code><span> 和基地址, 并先行调用了父类的构造函数</span><code>_ZN4BaseC2Ei</code><span>, 待其执行完毕后, 从函数栈内取出位于</span><code>s0</code><span>下偏移24处的双字长局部变量基地址至</span><code>a5</code><span>, 取出位于</span><code>s0</code><span>下偏移32处的双字长(8字节)参数</span><code>27</code><span>至</span><code>a4</code><span>, 最后, 在基地址偏移量</span><code>8</code><span>处存放了参数</span><code>27</code><span>.</span></p><blockquote><p><span>为什么偏移量为8？</span>
<span>由于基类的Base的大小为4字节, 不满足RISCV的8字节内存对齐要求, 故在Base的数据后添加4字节的padding.</span></p></blockquote><p><span>经过此实验我们得出了一个严谨的结论: </span><strong><span>派生类的构建是从父类开始的, 并且是先存放父类的成员, 再存放派生类的成员.</span></strong></p><p><span>此时</span><code>d1</code><span>在</span><code>main</code><span>函数栈帧上的数据排列为:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+----------------------+</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Base::base_var | Base::padding | Derived::derived_var |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; (4 bytes) &nbsp;  | &nbsp; (4 bytes) &nbsp; | &nbsp; &nbsp; (8 bytes) &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+----------------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; &nbsp; &nbsp; 13 &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; 27 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+----------------------+</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 134px;"></div><div class="CodeMirror-gutters" style="display: none; height: 134px;"></div></div></div></pre><p><span>可以想象在继承链存在时(长度大于2的继承), 子类的数据排列是如何的: </span><strong><span>从继承链最开始依次排列.</span></strong></p><h4 id='对象切片-object-slicing'><span>对象切片 (Object Slicing)</span></h4><p><span>事情还没有结束, 接着观察接下来的</span><code>main</code><span>函数的汇编代码片段:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">b1:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  .zero &nbsp; 4</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span>,s0,-24</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a2</span>,27</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">li</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a1</span>,13</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,a5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">call</span> &nbsp; &nbsp;<span class="cm-builtin">_ZN7DerivedC1Eii</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#------------------------#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">lui</span> &nbsp; &nbsp; <span class="cm-keyword">a5</span>,%hi(b1)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">lw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,-32(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">sw</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a4</span>,%lo(b1)(a5)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">#------------------------#</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p><span>第2行代码从</span><code>s0</code><span>下偏移32处-即为</span><code>d1</code><span>的基地址处取出单字长的数据存放至</span><code>a4</code><span>, 即取出了</span><code>d1.base_var</code><span>, 第3行代码直接将</span><code>a4</code><span>的数据拷贝</span><code>b1</code><span>所在的位置.</span></p><p><code>d1</code><span>被截断了🤯! 在</span><strong><span>编译期</span></strong><span>从</span><code>d1</code><span>转换至</span><code>b1</code><span>的过程中, </span><code>d1.derived_var</code><span>被汇编代码直接丢弃, 仿佛以下的情形发生:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+----------------------+</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Base::base_var | Base::padding | Derived::derived_var |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; (4 bytes) &nbsp;  | &nbsp; (4 bytes) &nbsp; | &nbsp; &nbsp; (8 bytes) &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+----------------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; &nbsp; &nbsp; 13 &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; 27 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+----------------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+ - - - - - - - - - - -+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Base::base_var | Base::padding | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; (4 bytes) &nbsp;  | &nbsp; (4 bytes) &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; &nbsp; &nbsp; 13 &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------+---------------+ - - - - - - - - - - -+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="display: none; height: 336px;"></div></div></div></pre><p><span>这就是单继承下的</span><strong><span>对象切片</span></strong><span> (是 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="9.526ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4210.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path><path id="MJX-3-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-3-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-3-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3-TEX-N-5B"></use></g><g data-mml-node="mi" transform="translate(278,0)"><use data-c="1D453" xlink:href="#MJX-3-TEX-I-1D453"></use></g><g data-mml-node="mi" transform="translate(828,0)"><use data-c="1D45F" xlink:href="#MJX-3-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(1279,0)"><use data-c="1D45C" xlink:href="#MJX-3-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(1764,0)"><use data-c="1D45A" xlink:href="#MJX-3-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(2642,0)"><use data-c="2C" xlink:href="#MJX-3-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(3086.7,0)"><use data-c="1D461" xlink:href="#MJX-3-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(3447.7,0)"><use data-c="1D45C" xlink:href="#MJX-3-TEX-I-1D45C"></use></g><g data-mml-node="mo" transform="translate(3932.7,0)"><use data-c="5D" xlink:href="#MJX-3-TEX-N-5D"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>f</mi><mi>r</mi><mi>o</mi><mi>m</mi><mo>,</mo><mi>t</mi><mi>o</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container><script type="math/tex">[from, to]</script><span> 的截取) , 截断 (是 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="5.309ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2346.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-4-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-4-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-4-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-4-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-4-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-4-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-4-TEX-N-5B"></use></g><g data-mml-node="mn" transform="translate(278,0)"><use data-c="30" xlink:href="#MJX-4-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(778,0)"><use data-c="2C" xlink:href="#MJX-4-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(1222.7,0)"><use data-c="1D461" xlink:href="#MJX-4-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(1583.7,0)"><use data-c="1D45C" xlink:href="#MJX-4-TEX-I-1D45C"></use></g><g data-mml-node="mo" transform="translate(2068.7,0)"><use data-c="5D" xlink:href="#MJX-4-TEX-N-5D"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mi>t</mi><mi>o</mi><mo stretchy="false">]</mo></math></mjx-assistive-mml></mjx-container><script type="math/tex">[0, to]</script><span> 的截取) 是切片的特例.</span></p><blockquote><p><span>如标题与上述实验所言, 在单继承时, 数据是从基类到派生类依次排列的, 有一种&quot;设计与实现协调&quot;之美, 但是在多继承下, 事情变得复杂起来, 因为多继承不仅仅是纵向的延申, 还伴有横向的扩展, 这使得类型转换不再是</span><strong><span>截断</span></strong><span>, 而是</span><strong><span>切片</span></strong><span>. 在这里我们不讨论多继承下的情况.</span></p></blockquote><h3 id='cpp-中的虚函数与虚表'><span>cpp 中的虚函数与虚表</span></h3><p><span>面向对象的另一特性是</span><strong><span>多态</span></strong><span>, 其允许​不同对象对同一消息 (方法调用) 做出差异化响应, 具体实现依赖于对象的​实际类型​ (动态类型) 而非声明类型 (静态类型) . 其本质是通过</span><strong><span>​抽象接口</span></strong><span>统一操作, 隐藏具体实现细节, 实现代码的</span><strong><span>​松耦合</span></strong><span>和</span><strong><span>​扩展性</span></strong><span>. </span></p><p><span>考虑一下代码:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Drawable</span>{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 抽象基类为接口</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">bool</span> <span class="cm-variable">draw</span>() <span class="cm-keyword">noexcept</span> {<span class="cm-keyword">return</span> <span class="cm-atom">false</span>;};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Circle</span>: <span class="cm-keyword">public</span> <span class="cm-variable">Drawable</span>{ &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 实现类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">bool</span> <span class="cm-variable">draw</span>() <span class="cm-keyword">noexcept</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// some process</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">drawShape</span>(<span class="cm-variable">Drawable</span><span class="cm-operator">&amp;</span> <span class="cm-variable">obj</span>){ &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 库函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// some other process</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">obj</span>.<span class="cm-variable">draw</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Circle</span> <span class="cm-variable">c</span> <span class="cm-operator">=</span> {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">auto</span> <span class="cm-variable">result</span> <span class="cm-operator">=</span> <span class="cm-variable">drawShape</span>(<span class="cm-variable">c</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 493px;"></div><div class="CodeMirror-gutters" style="display: none; height: 493px;"></div></div></div></pre><p><span>这是一个十分不标准的例子, 但之后我们会修改它. 这段代码中</span><code>result</code><span>的值是什么呢? 答案就在汇编代码当中:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">drawShape(Drawable&amp;):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">call</span> &nbsp; &nbsp;<span class="cm-tag">Drawable:</span>:draw() &nbsp; &nbsp;<span class="cm-comment"># *Here</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">jr</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">ra</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 112px;"></div><div class="CodeMirror-gutters" style="display: none; height: 112px;"></div></div></div></pre><p><span>我们可以看到一切在编译期就已经确定, </span><code>drawShape</code><span>内部调用的是</span><code>Drawable</code><span>的</span><code>draw()</code><span>函数, 所以答案是</span><code>false</code><span>. 可这并不能满足我们的要求, 我们希望</span><code>drawShape</code><span>函数可以</span><strong><span>动态地</span></strong><span>找到实现类对应的方法, 该怎么办呢🤔? 答案就是使用虚函数:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Drawable</span>{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 抽象基类为接口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">virtual</span> <span class="cm-variable-3">bool</span> <span class="cm-variable">draw</span>() <span class="cm-keyword">noexcept</span> {<span class="cm-keyword">return</span> <span class="cm-atom">false</span>;};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Circle</span>: <span class="cm-keyword">public</span> <span class="cm-variable">Drawable</span>{ &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 实现类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">bool</span> <span class="cm-variable">draw</span>() <span class="cm-keyword">noexcept</span> <span class="cm-keyword">override</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// some process</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">drawShape</span>(<span class="cm-variable">Drawable</span><span class="cm-operator">&amp;</span> <span class="cm-variable">obj</span>){ &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 库函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// some other process</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">obj</span>.<span class="cm-variable">draw</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>(){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// 入口函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Circle</span> <span class="cm-variable">c</span> <span class="cm-operator">=</span> {};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">drawShape</span>(<span class="cm-variable">c</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 515px;"></div><div class="CodeMirror-gutters" style="display: none; height: 515px;"></div></div></div></pre><p><span>当一个类存在虚函数或重写了父类的虚函数时，其头部会内含一个(在多继承下是多个)</span><strong><span>虚函数表指针</span></strong><span>，它指向</span><strong><span>虚函数表</span></strong><span>，虚函数表内记录了当前类对于虚函数的实现(重写)函数的地址。</span></p><p><span>当构建</span><code>c</code><span>时, 会向其头部写入虚表指针:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">lui</span> &nbsp; &nbsp; <span class="cm-keyword">a5</span>,%hi(vtable for Circle+16)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span>,a5,%lo(vtable for Circle+16) &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 16字节偏移量, </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 请注意这是编译器优化后的行为</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">sd</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-24(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">vtable</span> <span class="cm-keyword">for</span> <span class="cm-tag">Circle:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .dword  0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .dword  typeinfo for Circle</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  .dword &nbsp;<span class="cm-tag">Circle:</span>:draw() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 在此</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 291px;"></div><div class="CodeMirror-gutters" style="display: none; height: 291px;"></div></div></div></pre><p><span>当执行</span><code>drawShape(c);</code><span>时:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag">main:</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">addi</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span>,s0,-24</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,a5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">call</span> &nbsp; &nbsp;<span class="cm-keyword">drawShape</span>(Drawable&amp;)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">drawShape(Drawable&amp;):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-24(s0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 加载对象的地址到 a5</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,0(a5) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 读取对象的 vptr（虚表指针）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,0(a5) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 读取虚表内的第一个条目,</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 即为Circle::draw()地址</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,-24(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">jalr</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 调用Circle::draw()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,a0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 358px;"></div><div class="CodeMirror-gutters" style="display: none; height: 358px;"></div></div></div></pre><p><code>main</code><span>将</span><code>c</code><span>的地址(引用)传递给</span><code>drawShape</code><span>, 其内通过重要的 </span><strong><code>jalr</code></strong><span> (jump an link register) 命令, 直接跳转到Circle::draw()的入口位置进行执行, 并将结果存放至 </span><code>a0</code><span>。</span></p><blockquote><p><strong><span>编译器优化对于虚表的影响</span></strong></p><p><span>在正常的多态流程中，对象会保存虚表的地址。在调用虚函数时，程序首先读取对象的虚表指针，之后再通过偏移量访问虚函数表内的某一个特定函数。但在当前的流程中，由于不涉及复杂情况(多继承等)，程序使用保存虚函数内函数指针替代保存虚表的方式，能够减少汇编代码行数。比如在当前示例中，由于</span><code>c</code><span>直接保存了虚函数表内的</span><code>Circle::draw()</code><span>的入口地址，所以</span><code>drawShape</code><span>的汇编代码可精简为:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="asm"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="asm"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 25.2px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">drawShape(Drawable&amp;):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,-24(s0) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 对象首地址即为Circle::draw() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">ld</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a0</span>,-24(s0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">jalr</span> &nbsp; &nbsp;<span class="cm-keyword">a5</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># 调用Circle::draw()</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">mv</span> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">a5</span>,a0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ..</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 157px;"></div><div class="CodeMirror-gutters" style="display: none; height: 157px;"></div></div></div></pre></blockquote><blockquote><p><strong><code>jalr</code></strong><span> 伪指令</span></p><p><code>jalr</code><span>是多态的重要实现方式，其用于间接跳转到寄存器中存储的地址，同时保存返回地址到 ra 寄存器。这是 RISC-V 中实现间接函数调用的标准方式。虚函数地址在编译时无法确定（因为多态），必须在运行时从虚表中动态加载到寄存器，再通过 jalr 跳转。</span></p></blockquote></div></div>
</body>
</html>